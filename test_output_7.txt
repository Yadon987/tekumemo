Config Hosts: [".localhost", ".test", #<IPAddr: IPv4:0.0.0.0/0.0.0.0>, #<IPAddr: IPv6:0000:0000:0000:0000:0000:0000:0000:0000/0000:0000:0000:0000:0000:0000:0000:0000>]
Current Path: /users/sign_in
Status Code: 200
Body: <!-- BEGIN app/views/layouts/application.html.erb --><!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>てくメモ - ログイン</title>
  <meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="C1NQH1hAvkkyalofEP6qvQ0QI6O1KbQGaNElHAtYNdI4YV9b-bJdy-tc7PHdqzWCuooVMJJAcQtBt807qrvnMg" />
  

  <!-- Tailwind CSSビルド済みファイル -->
  <link rel="stylesheet" href="/assets/application-8690132044e8da9564afdc107981426b2d0d577d372c9e33b04cbfadd39b7c36.css" data-turbo-track="reload" />
  <script src="/assets/application-21a9e5c2680386f6fd36db13ddb1eb804a0514ccdda5483ee02a01c97bc951db.js" data-turbo-track="reload" type="module"></script>

  <!-- Google Fonts: Noto Sans JP -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet" />

  <!-- Google Material Symbols -->
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />

  <!-- ダークモード初期化スクリプト（FOUC防止） -->
  <script>
    // ページ読み込み前にダークモードを設定（フラッシュ防止）
    (function() {
      const theme = localStorage.getItem('theme') || 'light';
      if (theme === 'dark') {
        document.documentElement.classList.add('dark');
      }
    })();
  </script>
</head>

<body class="bg-background-light dark:bg-background-dark font-display transition-colors duration-200">
  <div class="flex flex-col min-h-screen">

    <!-- ===== フローティングヘッダー（モバイルファースト・レスポンシブ対応） ===== -->
    <header class="fixed top-0 left-0 right-0 z-50 bg-background-light dark:bg-background-dark border-b border-gray-200 dark:border-gray-700">
      <div class="flex justify-between items-center py-2 px-3 sm:py-4 sm:px-4 w-full max-w-4xl mx-auto">
        <!-- 左側：ダークモード切り替えトグルスイッチ（モバイル：小、PC：中） -->
        <div class="w-16 sm:w-24 flex justify-start items-center">
          <!-- Stimulusコントローラーでダークモード切り替えを制御 -->
          <div data-controller="dark-mode-toggle">
            <!-- トグルスイッチのボタン -->
            <button
              type="button"
              data-action="click->dark-mode-toggle#toggle"
              aria-label="ダークモード切り替え"
              class="relative flex items-center">

              <!-- トグルスイッチの背景（モバイル：小、PC：中） -->
              <div
                data-dark-mode-toggle-target="toggle"
                class="w-9 h-5 sm:w-11 sm:h-6 bg-gray-300 rounded-full shadow-inner transition-all duration-300 ease-in-out">

                <!-- スライダー（丸いつまみ・モバイル：小、PC：中） -->
                <div
                  data-dark-mode-toggle-target="slider"
                  class="absolute top-0.5 left-0.5 w-4 h-4 sm:w-5 sm:h-5 bg-white rounded-full shadow-md transition-transform duration-300 ease-in-out flex items-center justify-center translate-x-0">

                  <!-- 月のアイコン（ライトモード時・モバイル：小、PC：中） -->
                  <span
                    data-dark-mode-toggle-target="icon"
                    data-icon="moon"
                    class="material-symbols-outlined text-[10px] sm:text-xs text-gray-700 transition-all duration-200 opacity-100 scale-100">
                    dark_mode
                  </span>

                  <!-- 太陽のアイコン（ダークモード時・モバイル：小、PC：中） -->
                  <span
                    data-dark-mode-toggle-target="icon"
                    data-icon="sun"
                    class="material-symbols-outlined text-[10px] sm:text-xs text-yellow-500 absolute transition-all duration-200 opacity-0 scale-0">
                    light_mode
                  </span>
                </div>
              </div>
            </button>
          </div>
        </div>

        <!-- 中央：ロゴ（モバイル：小、PC：中） -->
        <div class="flex items-center space-x-2 sm:space-x-3">
          <!-- 左側のアイコン（モバイル：小、PC：中） -->
          <div class="h-7 w-7 sm:h-10 sm:w-10 flex items-center justify-center bg-gradient-to-br from-sky-400 to-blue-500 rounded-lg sm:rounded-xl shadow-md">
            <span class="material-symbols-outlined text-lg sm:text-2xl text-white">footprint</span>
          </div>

          <!-- グラデーションテキストロゴ（モバイル：小、PC：大） -->
          <span class="text-xl sm:text-3xl font-bold bg-gradient-to-r from-sky-500 to-blue-600 dark:from-sky-400 dark:to-blue-500 bg-clip-text text-transparent whitespace-nowrap">
            てくメモ
          </span>
        </div>

        <!-- 右側：ログイン/ログアウトボタン（モバイル：小、PC：中） -->
        <div class="w-14 sm:w-20 flex justify-end items-center">
            <!-- ログインボタン（青いグラデーション丸ボタン・モバイル：小、PC：中） -->
            <a aria_label="ログイン" class="w-8 h-8 sm:w-12 sm:h-12 rounded-full bg-gradient-to-br from-blue-400 to-blue-600 dark:from-blue-500 dark:to-blue-700 flex items-center justify-center shadow-md hover:shadow-lg hover:scale-110 transition-all duration-300" href="/users/sign_in">
              <span class="material-symbols-outlined text-lg sm:text-2xl text-white">login</span>
</a>        </div>
      </div>
    </header>

    <!-- ===== メインコンテンツ ===== -->
    <!-- ヘッダー分のpadding-topを追加（モバイル：小、PC：大） -->
    <main class="flex-1 w-full pt-12 sm:pt-20">
      <!-- Flashメッセージ -->


      <!-- BEGIN app/views/devise/sessions/new.html.erb -->
<div class="flex flex-1 flex-col items-center justify-center p-4 pb-24">
  <div class="w-full max-w-md">

    <!-- Header -->
    <div class="mb-8 flex flex-col items-center">
      <h1 class="text-3xl font-bold text-gray-800 dark:text-white">おかえりなさい</h1>
      <p class="mt-2 text-base text-gray-600 dark:text-gray-400">てくメモへようこそ!</p>
    </div>

    <!-- Login Form -->
    <form class="space-y-6" id="new_user" action="/users/sign_in" accept-charset="UTF-8" method="post"><input type="hidden" name="authenticity_token" value="URqyyocf-3eizww23u7b3jxfvmLLg75OCn9opSnN7IIHkrdLDIIL1oY_K0YuMXM5mNaZiCwdmDrylPFDcA2o3Q" autocomplete="off" />

      <!-- Email Field -->
      <div class="space-y-2">
        <label class="block text-base font-medium text-gray-700 dark:text-gray-300" for="user_email">メールアドレス</label>
        <div class="relative">
          <span class="material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 dark:text-gray-500">mail</span>
          <input autofocus="autofocus" autocomplete="email" placeholder="メールアドレス" class="block w-full h-14 pl-12 pr-4 text-base text-gray-900 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-800 dark:border-gray-600 dark:text-white dark:placeholder-gray-500" type="email" value="" name="user[email]" id="user_email" />
        </div>
      </div>

      <!-- Password Field -->
      <div class="space-y-2">
        <label class="block text-base font-medium text-gray-700 dark:text-gray-300" for="user_password">パスワード</label>
        <div class="relative">
          <span class="material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 dark:text-gray-500">lock</span>
          <input autocomplete="current-password" placeholder="パスワード" id="login-password-field" class="block w-full h-14 pl-12 pr-12 text-base text-gray-900 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-800 dark:border-gray-600 dark:text-white dark:placeholder-gray-500" type="password" name="user[password]" />
          <button type="button"
                  onclick="togglePasswordVisibility('login-password-field', 'login-password-icon')"
                  class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300">
            <span class="material-symbols-outlined" id="login-password-icon">visibility</span>
          </button>
        </div>

        <!-- Remember Me -->
          <div class="flex items-center mt-3">
            <input name="user[remember_me]" type="hidden" value="0" autocomplete="off" /><input class="w-5 h-5 text-primary bg-white border-gray-300 rounded focus:ring-primary focus:ring-2 dark:bg-gray-700 dark:border-gray-600" type="checkbox" value="1" name="user[remember_me]" id="user_remember_me" />
            <label class="ml-2 text-sm text-gray-700 dark:text-gray-300" for="user_remember_me">ログインしたままにする</label>
          </div>
      </div>

      <!-- Submit Button -->
      <div class="space-y-4">
        <input type="submit" name="commit" value="ログインする" class="w-full h-14 bg-primary hover:bg-blue-700 text-white text-base font-bold rounded-full transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2" data-disable-with="ログインする" />

        <!-- Forgot Password Link -->
          <div class="text-center">
            <a class="text-sm text-primary hover:underline" href="/users/password/new">パスワードをお忘れですか?</a>
          </div>
      </div>
</form>
    <!-- Divider -->
    <div class="my-8 flex items-center">
      <div class="flex-1 border-t border-gray-300 dark:border-gray-700"></div>
      <span class="px-4 text-sm text-gray-500 dark:text-gray-400">または</span>
      <div class="flex-1 border-t border-gray-300 dark:border-gray-700"></div>
    </div>

    <!-- Google Login Button (Future Implementation) -->
    <button type="button"
            disabled
            class="w-full h-14 flex items-center justify-center bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed">
      <svg class="w-6 h-6 mr-3" viewBox="0 0 48 48">
        <path d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12s5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24s8.955,20,20,20s20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z" fill="#FFC107"></path>
        <path d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z" fill="#FF3D00"></path>
        <path d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z" fill="#4CAF50"></path>
        <path d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571l6.19,5.238C41.38,36.43,44,30.63,44,24C44,22.659,43.862,21.35,43.611,20.083z" fill="#1976D2"></path>
      </svg>
      <span class="text-base font-medium text-gray-700 dark:text-gray-300">Googleでログイン</span>
    </button>

    <!-- Sign Up Link -->
    <p class="mt-8 text-center text-base text-gray-600 dark:text-gray-400">
      アカウントをお持ちでないですか?
        <a class="font-medium text-primary hover:underline" href="/users/sign_up">新規登録</a>
    </p>

  </div>
</div>

<script>
function togglePasswordVisibility(fieldId, iconId) {
  const field = document.getElementById(fieldId);
  const icon = document.getElementById(iconId);

  if (!field || !icon) return;

  if (field.type === 'password') {
    field.type = 'text';
    icon.textContent = 'visibility_off';
  } else {
    field.type = 'password';
    icon.textContent = 'visibility';
  }
}
</script>
<!-- END app/views/devise/sessions/new.html.erb -->
    </main>

    <!-- ===== Expandable FAB（展開可能なFloating Action Button）（ログイン時のみ） ===== -->
  </div>
</body>
</html>
<!-- END app/views/layouts/application.html.erb -->
F

Failures:

  1) Walks 散歩記録の新規作成 フォームに正常な値を入力した場合 散歩記録が保存され、一覧画面に表示されること
     Failure/Error: expect(page).to have_content "散歩記録を作成しました"
       expected to find text "散歩記録を作成しました" in "ActionController::InvalidAuthenticityToken in WalksController#create\nCan't verify CSRF token authenticity.\nExtracted source (around line #314):\n312 313 314 315 316 317\ndef handle_unverified_request\nraise ActionController::InvalidAuthenticityToken, warning_message\nend\nend\nend\nExtracted source (around line #408):\n406 407 408 409 410 411\nend\nprotection_strategy.handle_unverified_request\nend\ndef unverified_request_warning_message\nExtracted source (around line #257):\n255 256 257 258 259 260\n# clear run strategies and remove cached variables.\ndef handle_unverified_request\nsuper # call the default behavior which resets/nullifies/raises\nrequest.env[\"devise.skip_storage\"] = true\nsign_out_all_scopes(false)\nend\nExtracted source (around line #397):\n395 396 397 398 399 400\nlogger.warn unverified_request_warning_message if logger && log_warning_on_csrf_failure\nhandle_unverified_request\nend\nend\nExtracted source (around line #362):\n360 361 362 363 364 365\ndef make_lambda\nlambda do |target, value, &block|\ntarget.send(@method_name, &block)\nend\nend\nExtracted source (around line #179):\n177 178 179 180 181 182\nif !halted && user_conditions.all? { |c| c.call(target, value) }\nresult_lambda = -> { user_callback.call target, value }\nenv.halted = halted_lambda.call(target, result_lambda)\nif env.halted\ntarget.send :halted_callback_hook, filter, name\nExtracted source (around line #34):\n32 33 34 35 36 37\nincluded do\ndefine_callbacks :process_action,\nterminator: ->(controller, result_lambda) { result_lambda.call; controller.performed? },\nskip_after_callbacks_if_terminated: true\nmattr_accessor :raise_on_missing_callback_actions, default: false\nend\nExtracted source (around line #180):\n178 179 180 181 182 183\nif !halted && user_conditions.all? { |c| c.call(target, value) }\nresult_lambda = -> { user_callback.call target, value }\nenv.halted = halted_lambda.call(target, result_lambda)\nif env.halted\ntarget.send :halted_callback_hook, filter, name\nend\nExtracted source (around line #560):\n558 559 560 561 562 563\ndef invoke_before(arg)\n@before&.each { |b| b.call(arg) }\nend\ndef invoke_after(arg)\nExtracted source (around line #560):\n558 559 560 561 562 563\ndef invoke_before(arg)\n@before&.each { |b| b.call(arg) }\nend\ndef invoke_after(arg)\nExtracted source (around line #560):\n558 559 560 561 562 563\ndef invoke_before(arg)\n@before&.each { |b| b.call(arg) }\nend\ndef invoke_after(arg)\nExtracted source (around line #119):\n117 118 119 120 121 122\nwhile true\ncurrent = next_sequence\ncurrent.invoke_before(env)\nif current.final?\nenv.value = !env.halted && (!block_given? || yield)\nelsif current.skip?(env)\nExtracted source (around line #141):\n139 140 141 142 143 144\nend\ninvoke_sequence.call\nend\nend\nend\nExtracted source (around line #260):\n258 259 260 261 262 263\n# callbacks around the normal behavior.\ndef process_action(...)\nrun_callbacks(:process_action) do\nsuper\nend\nend\nExtracted source (around line #27):\n25 26 27 28 29 30\nprivate\ndef process_action(*)\nsuper\nrescue Exception => exception\nrequest.env[\"action_dispatch.show_detailed_exceptions\"] ||= show_detailed_exceptions?\nrescue_with_handler(exception) || raise\nExtracted source (around line #77):\n75 76 77 78 79 80\nActiveSupport::Notifications.instrument(\"process_action.action_controller\", raw_payload) do |payload|\nresult = super\npayload[:response] = response\npayload[:status] = response.status\nresult\nExtracted source (around line #210):\n208 209 210 211 212 213\ndef instrument(name, payload = {})\nif notifier.listening?(name)\ninstrumenter.instrument(name, payload) { yield payload if block_given? }\nelse\nyield payload if block_given?\nend\nExtracted source (around line #58):\n56 57 58 59 60 61\nhandle.start\nbegin\nyield payload if block_given?\nrescue Exception => e\npayload[:exception] = [e.class.name, e.message]\npayload[:exception_object] = e\nExtracted source (around line #210):\n208 209 210 211 212 213\ndef instrument(name, payload = {})\nif notifier.listening?(name)\ninstrumenter.instrument(name, payload) { yield payload if block_given? }\nelse\nyield payload if block_given?\nend\nExtracted source (around line #76):\n74 75 76 77 78 79\nActiveSupport::Notifications.instrument(\"start_processing.action_controller\", raw_payload)\nActiveSupport::Notifications.instrument(\"process_action.action_controller\", raw_payload) do |payload|\nresult = super\npayload[:response] = response\npayload[:status] = response.status\nExtracted source (around line #259):\n257 258 259 260 261 262\ndef process_action(*)\n_perform_parameter_wrapping if _wrapper_enabled?\nsuper\nend\n# Returns the wrapper key which will be used to store wrapped parameters.\nExtracted source (around line #39):\n37 38 39 40 41 42\n# and it won't be cleaned up by the method below.\nActiveRecord::RuntimeRegistry.reset\nsuper\nend\ndef cleanup_view_runtime\nExtracted source (around line #152):\n150 151 152 153 154 155\n@_response_body = nil\nprocess_action(action_name, ...)\nend\n# Delegates to the class's ::controller_path.\nExtracted source (around line #40):\n38 39 40 41 42 43\ndef process(...) # :nodoc:\nold_config, I18n.config = I18n.config, I18nProxy.new(I18n.config, lookup_context)\nsuper\nensure\nI18n.config = old_config\nend\nExtracted source (around line #252):\n250 251 252 253 254 255\nset_request!(request)\nset_response!(response)\nprocess(name)\nrequest.commit_flash\nto_a\nend\nExtracted source (around line #335):\n333 334 335 336 337 338\nmiddleware_stack.build(name) { |env| new.dispatch(name, req, res) }.call req.env\nelse\nnew.dispatch(name, req, res)\nend\nend\nend\nExtracted source (around line #67):\n65 66 67 68 69 70\ndef dispatch(controller, action, req, res)\ncontroller.dispatch(action, req, res)\nend\nend\nExtracted source (around line #50):\n48 49 50 51 52 53\ncontroller = controller req\nres = controller.make_response! req\ndispatch(controller, params[:action], req, res)\nrescue ActionController::RoutingError\nif @raise_on_name_error\nraise\nExtracted source (around line #53):\n51 52 53 54 55 56\nreq.route_uri_pattern = route.path.spec.to_s\n_, headers, _ = response = route.app.serve(req)\nif \"pass\" == headers[Constants::X_CASCADE]\nreq.script_name = script_name\nExtracted source (around line #133):\n131 132 133 134 135 136\npath_parameters[name.to_sym] = Utils.unescape_uri(val) if val\n}\nyield [match_data, path_parameters, r]\n}\nend\nExtracted source (around line #126):\n124 125 126 127 128 129\nroutes.sort_by!(&:precedence)\nroutes.each { |r|\nmatch_data = r.path.match(path_info)\npath_parameters = {}\nmatch_data.names.each_with_index { |name, i|\nExtracted source (around line #126):\n124 125 126 127 128 129\nroutes.sort_by!(&:precedence)\nroutes.each { |r|\nmatch_data = r.path.match(path_info)\npath_parameters = {}\nmatch_data.names.each_with_index { |name, i|\nExtracted source (around line #34):\n32 33 34 35 36 37\ndef serve(req)\nfind_routes(req) do |match, parameters, route|\nset_params = req.path_parameters\npath_info = req.path_info\nscript_name = req.script_name\nExtracted source (around line #896):\n894 895 896 897 898 899\nreq = make_request(env)\nreq.path_info = Journey::Router::Utils.normalize_path(req.path_info)\n@router.serve(req)\nend\ndef recognize_path(path, environment = {})\nExtracted source (around line #202):\n200 201 202 203 204 205\nend\n@app.call(env)\nend\ndef warn_if_using_get_on_request_path\nExtracted source (around line #169):\n167 168 169 170 171 172\n# @param [Hash] The Rack environment.\ndef call(env)\ndup.call!(env)\nend\n# The logic for dispatching any additional actions that need\nExtracted source (around line #36):\n34 35 36 37 38 39\nresult = catch(:warden) do\nenv['warden'].on_request\n@app.call(env)\nend\nresult ||= {}\nExtracted source (around line #34):\n32 33 34 35 36 37\nenv['warden'] = Proxy.new(env, self)\nresult = catch(:warden) do\nenv['warden'].on_request\n@app.call(env)\nend\nExtracted source (around line #34):\n32 33 34 35 36 37\nenv['warden'] = Proxy.new(env, self)\nresult = catch(:warden) do\nenv['warden'].on_request\n@app.call(env)\nend\nExtracted source (around line #20):\n18 19 20 21 22 23\nbegin\n_, _, body = response = @app.call(env)\nrescue Exception\nenv[RACK_TEMPFILES]&.each(&:close!)\nraise\nExtracted source (around line #29):\n27 28 29 30 31 32\ndef call(env)\nstatus, headers, body = response = @app.call(env)\nif etag_status?(status) && body.respond_to?(:to_ary) && !skip_caching?(headers)\nbody = body.to_ary\nExtracted source (around line #44):\n42 43 44 45 46 47\nresponse\nelse\n@app.call(env)\nend\nend\nExtracted source (around line #15):\n13 14 15 16 17 18\ndef call(env)\n_, _, body = response = @app.call(env)\nif env[REQUEST_METHOD] == HEAD\nbody.close if body.respond_to?(:close)\nExtracted source (around line #38):\n36 37 38 39 40 41\ndef call(env)\n_, headers, _ = response = @app.call(env)\nreturn response if policy_present?(headers)\nExtracted source (around line #38):\n36 37 38 39 40 41\ndef call(env)\nstatus, headers, _ = response = @app.call(env)\n# Returning CSP headers with a 304 Not Modified is harmful, since nonces in the\n# new CSP headers might not match nonces in the cached HTML.\nExtracted source (around line #274):\n272 273 274 275 276 277\nreq = make_request env\nprepare_session(req)\nstatus, headers, body = app.call(req.env)\nres = Rack::Response::Raw.new status, headers\ncommit_session(req, res)\n[status, headers, body]\nExtracted source (around line #268):\n266 267 268 269 270 271\ndef call(env)\ncontext(env)\nend\ndef context(env, app = @app)\nExtracted source (around line #704):\n702 703 704 705 706 707\ndef call(env)\nrequest = ActionDispatch::Request.new(env)\nresponse = @app.call(env)\nif request.have_cookie_jar?\ncookie_jar = request.cookie_jar\nExtracted source (around line #674):\n672 673 674 675 676 677\nend\n@app.call(env)\nend\nprivate\nExtracted source (around line #31):\n29 30 31 32 33 34\nerror = nil\nresult = run_callbacks :call do\n@app.call(env)\nrescue => error\nend\nraise error if error\nExtracted source (around line #101):\n99 100 101 102 103 104\nif callbacks.empty?\nyield if block_given?\nelse\nenv = Filters::Environment.new(self, false, nil)\nExtracted source (around line #30):\n28 29 30 31 32 33\ndef call(env)\nerror = nil\nresult = run_callbacks :call do\n@app.call(env)\nrescue => error\nend\nExtracted source (around line #16):\n14 15 16 17 18 19\nstate = @executor.run!(reset: true)\nbegin\nresponse = @app.call(env)\nif env[\"action_dispatch.report_exception\"]\nerror = env[\"action_dispatch.exception\"]\nExtracted source (around line #18):\n16 17 18 19 20 21\ndef call(env)\nrequest = ActionDispatch::Request.new(env)\nreturn @app.call(env) unless actionable_request?(request)\nActiveSupport::ActionableError.dispatch(request.params[:error].to_s.safe_constantize, request.params[:action])\nExtracted source (around line #31):\n29 30 31 32 33 34\ndef call(env)\n_, headers, body = response = @app.call(env)\nif headers[Constants::X_CASCADE] == \"pass\"\nbody.close if body.respond_to?(:close)\nExtracted source (around line #132):\n130 131 132 133 134 135\ndef call_app(env)\n@app.call(env)\nrescue => e\nthrow :app_exception, e\nend\nExtracted source (around line #28):\n26 27 28 29 30 31\nstatus, headers, body = call_app(env)\nif (session = Session.from(Thread.current)) && acceptable_content_type?(headers)\nheaders[\"x-web-console-session-id\"] = session.id\nExtracted source (around line #17):\n15 16 17 18 19 20\ndef call(env)\napp_exception = catch :app_exception do\nrequest = create_regular_or_whiny_request(env)\nreturn call_app(env) unless request.permitted?\nExtracted source (around line #17):\n15 16 17 18 19 20\ndef call(env)\napp_exception = catch :app_exception do\nrequest = create_regular_or_whiny_request(env)\nreturn call_app(env) unless request.permitted?\nExtracted source (around line #32):\n30 31 32 33 34 35\ndef call(env)\n@app.call(env)\nrescue Exception => exception\nrequest = ActionDispatch::Request.new env\nbacktrace_cleaner = request.get_header(\"action_dispatch.backtrace_cleaner\")\nExtracted source (around line #41):\n39 40 41 42 43 44\nlogger.info { started_request_message(request) }\nstatus, headers, body = response = @app.call(env)\nbody = ::Rack::BodyProxy.new(body) { finish_request_instrumentation(handle, logger_tag_pop_count) }\nif response.frozen?\nExtracted source (around line #29):\n27 28 29 30 31 32\nend\ncall_app(request, env)\nend\nprivate\nExtracted source (around line #17):\n15 16 17 18 19 20\n::Rails.logger.silence { @app.call(env) }\nelse\n@app.call(env)\nend\nend\nExtracted source (around line #96):\n94 95 96 97 98 99\nreq = ActionDispatch::Request.new env\nreq.remote_ip = GetIp.new(req, check_ip, proxies)\n@app.call(req.env)\nend\n# The GetIp class exists as a way to defer processing of the request data into\nExtracted source (around line #33):\n31 32 33 34 35 36\nreq = ActionDispatch::Request.new env\nreq.request_id = make_request_id(req.headers[@header])\n@app.call(env).tap { |_status, headers, _body| headers[@header] = req.request_id }\nend\nprivate\nExtracted source (around line #28):\n26 27 28 29 30 31\nend\n@app.call(env)\nend\ndef method_override(env)\nExtracted source (around line #24):\n22 23 24 25 26 27\ndef call(env)\nstart_time = Utils.clock_time\n_, headers, _ = response = @app.call(env)\nrequest_time = Utils.clock_time - start_time\nExtracted source (around line #29):\n27 28 29 30 31 32\ndef call(env)\nLocalCacheRegistry.set_cache_for(local_cache_key, LocalStore.new)\nresponse = @app.call(env)\nresponse[2] = ::Rack::BodyProxy.new(response[2]) do\nLocalCacheRegistry.set_cache_for(local_cache_key, nil)\nend\nExtracted source (around line #61):\n59 60 61 62 63 64\nresponse = nil\nevents = @subscriber.collect_events do\nresponse = @app.call(env)\nend\nheaders = response[1]\nExtracted source (around line #26):\n24 25 26 27 28 29\nevents = []\nActiveSupport::IsolatedExecutionState[KEY] = events\nyield\nevents\nensure\nActiveSupport::IsolatedExecutionState.delete(KEY)\nExtracted source (around line #60):\n58 59 60 61 62 63\ndef call(env)\nresponse = nil\nevents = @subscriber.collect_events do\nresponse = @app.call(env)\nend\nExtracted source (around line #16):\n14 15 16 17 18 19\nstate = @executor.run!(reset: true)\nbegin\nresponse = @app.call(env)\nif env[\"action_dispatch.report_exception\"]\nerror = env[\"action_dispatch.exception\"]\nExtracted source (around line #27):\n25 26 27 28 29 30\ndef call(env)\n@file_handler.attempt(env) || @app.call(env)\nend\nend\nExtracted source (around line #131):\n129 130 131 132 133 134\ndef call(env)\n_, headers, body = response = @app.call(env)\nif body.respond_to?(:to_path)\ncase type = variation(env)\nExtracted source (around line #143):\n141 142 143 144 145 146\nif hosts.empty? || excluded?(request)\nmark_as_authorized(request)\n@app.call(env)\nelse\nenv[\"action_dispatch.blocked_hosts\"] = hosts\n@response_app.call(env)\nExtracted source (around line #535):\n533 534 535 536 537 538\ndef call(env)\nreq = build_request env\napp.call req.env\nend\n# Defines additional Rack env configuration that is added on each call.\nExtracted source (around line #76):\n74 75 76 77 78 79\nenv[PATH_INFO] = rest\nreturn app.call(env)\nend\n[404, { CONTENT_TYPE => \"text/plain\", \"x-cascade\" => \"pass\" }, [\"Not Found: \#{path}\"]]\nExtracted source (around line #60):\n58 59 60 61 62 63\nis_host_known = @known_hosts.include? http_host\n@mapping.each do |host, location, match, app|\nunless casecmp?(http_host, host) \\\n|| casecmp?(server_name, host) \\\n|| (!host && is_same_server) \\\nExtracted source (around line #60):\n58 59 60 61 62 63\nis_host_known = @known_hosts.include? http_host\n@mapping.each do |host, location, match, app|\nunless casecmp?(http_host, host) \\\n|| casecmp?(server_name, host) \\\n|| (!host && is_same_server) \\\nExtracted source (around line #283):\n281 282 283 284 285 286\n# every time it is called, so it should not be used if performance is important.\ndef call(env)\nto_app.call(env)\nend\nprivate\nExtracted source (around line #360):\n358 359 360 361 362 363\nenv['HTTP_COOKIE'] ||= cookie_jar.for(uri)\n@last_request = Rack::Request.new(env)\nstatus, headers, body = @app.call(env).to_a\n@last_response = MockResponse.new(status, headers, body, env['rack.errors'].flush)\nclose_body(body)\nExtracted source (around line #163):\n161 162 163 164 165 166\nuri = parse_uri(uri, env)\nenv = env_for(uri, env.merge(method: verb.to_s.upcase, params: params))\nprocess_request(uri, env, &block)\nend\n# Set a header to be included on all subsequent requests through the\nExtracted source (around line #112):\n110 111 112 113 114 115\nclass_eval(<<-END, __FILE__, __LINE__+1)\ndef \#{method_name}(uri, params = {}, env = {}, &block)\ncustom_request('\#{method_name.upcase}', uri, params, env, &block)\nend\nEND\nend\nExtracted source (around line #138):\n136 137 138 139 140 141\nhash.each do |methods, accessor|\nunless defined?(methods.each)\ndef_instance_delegator(accessor, methods)\nelse\nmethods.each {|method| def_instance_delegator(accessor, method)}\nend\nExtracted source (around line #81):\n79 80 81 82 83 84\nreset_cache!\n@new_visit_request = false\nsend(method, new_uri.to_s, attributes, env.merge(options[:headers] || {}))\nend\ndef build_uri(path)\nExtracted source (around line #56):\n54 55 56 57 58 59\ndef process_and_follow_redirects(method, path, attributes = {}, env = {})\n@current_fragment = build_uri(path).fragment\nprocess(method, path, attributes, env)\nreturn unless driver.follow_redirects?\ndriver.redirect_limit.times do\nExtracted source (around line #40):\n38 39 40 41 42 43\nenv = { 'HTTP_REFERER' => referer_url }\nenv['CONTENT_TYPE'] = content_type if content_type\nprocess_and_follow_redirects(\nmethod,\nuri.to_s,\nattributes,\nExtracted source (around line #57):\n55 56 57 58 59 60\naction = button&.[]('formaction') || native['action']\nmethod = button&.[]('formmethod') || request_method\ndriver.submit(method, action.to_s, params(button), content_type: native['enctype'])\nend\ndef multipart?\nExtracted source (around line #69):\n67 68 69 70 71 72\nelsif submits?\nassociated_form = form\nCapybara::RackTest::Form.new(driver, associated_form).submit(self) if associated_form\nelsif checkable?\nset(!checked?)\nelsif tag_name == 'label'\nExtracted source (around line #131):\n129 130 131 132 133 134\ndef \#{meth_name}(...)\nstale_check\nmethod(:\"unchecked_\#{meth_name}\").call(...)\nend\nMETHOD\nend\nExtracted source (around line #131):\n129 130 131 132 133 134\ndef \#{meth_name}(...)\nstale_check\nmethod(:\"unchecked_\#{meth_name}\").call(...)\nend\nMETHOD\nend\nExtracted source (around line #172):\n170 171 172 173 174 175\ndef click(*keys, **options)\nperform_click_action(keys, **options) do |k, opts|\nbase.click(k, **opts)\nend\nend\nExtracted source (around line #608):\n606 607 608 609 610 611\noptions[:offset] ||= :center if session_options.w3c_click_offset\nsynchronize(wait) { yield keys, options }\nself\nend\nend\nExtracted source (around line #84):\n82 83 84 85 86 87\ntimer = Capybara::Helpers.timer(expire_in: seconds)\nbegin\nyield\nrescue StandardError => e\nsession.raise_server_error!\nraise e unless catch_error?(e, errors)\nExtracted source (around line #608):\n606 607 608 609 610 611\noptions[:offset] ||= :center if session_options.w3c_click_offset\nsynchronize(wait) { yield keys, options }\nself\nend\nend\nExtracted source (around line #171):\n169 170 171 172 173 174\n# @return [Capybara::Node::Element] The element\ndef click(*keys, **options)\nperform_click_action(keys, **options) do |k, opts|\nbase.click(k, **opts)\nend\nend\nExtracted source (around line #58):\n56 57 58 59 60 61\n# @return [Capybara::Node::Element] The element clicked\ndef click_button(locator = nil, **options)\nfind(:button, locator, **options).click\nend\n##\nExtracted source (around line #774):\n772 773 774 775 776 777\ndef \#{method}(...)\n@touched = true\ncurrent_scope.\#{method}(...)\nend\nMETHOD\nend\nExtracted source (around line #52):\n50 51 52 53 54 55\nclass_eval <<~METHOD, __FILE__, __LINE__ + 1\ndef \#{method}(...)\npage.method(\"\#{method}\").call(...)\nend\nMETHOD\nend\nExtracted source (around line #52):\n50 51 52 53 54 55\nclass_eval <<~METHOD, __FILE__, __LINE__ + 1\ndef \#{method}(...)\npage.method(\"\#{method}\").call(...)\nend\nMETHOD\nend\nExtracted source (around line #41):\n39 40 41 42 43 44\n# 保存ボタンをクリック\nclick_button \"散歩記録を保存\"\n# 保存後の検証\n# 一覧画面にリダイレクトされているか確認\nExtracted source (around line #263):\n261 262 263 264 265 266\nrun_before_example\nRSpec.current_scope = :example\n@example_group_instance.instance_exec(self, &@example_block)\nif pending?\nPending.mark_fixed! self\nExtracted source (around line #263):\n261 262 263 264 265 266\nrun_before_example\nRSpec.current_scope = :example\n@example_group_instance.instance_exec(self, &@example_block)\nif pending?\nPending.mark_fixed! self\nExtracted source (around line #511):\n509 510 511 512 513 514\nsingleton_context_hooks_host = example_group_instance.singleton_class\nsingleton_context_hooks_host.run_before_context_hooks(example_group_instance)\nwith_around_example_hooks { yield }\nensure\nsingleton_context_hooks_host.run_after_context_hooks(example_group_instance)\nend\nExtracted source (around line #468):\n466 467 468 469 470 471\ndef with_around_example_hooks\nRSpec.current_scope = :before_example_hook\nhooks.run(:around, :example, self) { yield }\nrescue Support::AllExceptionsExceptOnesWeMustNotRescue => e\nset_exception(e)\nend\nExtracted source (around line #486):\n484 485 486 487 488 489\nwhen :before then run_example_hooks_for(example_or_group, :before, :reverse_each)\nwhen :after then run_example_hooks_for(example_or_group, :after, :each)\nwhen :around then run_around_example_hooks_for(example_or_group) { yield }\nend\nend\nend\nExtracted source (around line #626):\n624 625 626 627 628 629\nreturn yield if hooks.empty? # exit early to avoid the extra allocation cost of `Example::Procsy`\ninitial_procsy = Example::Procsy.new(example) { yield }\nhooks.inject(initial_procsy) do |procsy, around_hook|\nprocsy.wrap { around_hook.execute_with(example, procsy) }\nend.call\nExtracted source (around line #352):\n350 351 352 353 354 355\ndef call(*args, &block)\n@executed = true\n@proc.call(*args, &block)\nend\nalias run call\nExtracted source (around line #171):\n169 170 171 172 173 174\naround do |example|\nexample.run\noriginal_after_teardown.bind(self).call\nend\nend\nExtracted source (around line #457):\n455 456 457 458 459 460\n# @private\ndef instance_exec(*args, &block)\n@example_group_instance.instance_exec(*args, &block)\nend\nprivate\nExtracted source (around line #457):\n455 456 457 458 459 460\n# @private\ndef instance_exec(*args, &block)\n@example_group_instance.instance_exec(*args, &block)\nend\nprivate\nExtracted source (around line #390):\n388 389 390 391 392 393\nclass AroundHook < Hook\ndef execute_with(example, procsy)\nexample.instance_exec(procsy, &block)\nreturn if procsy.executed?\nPending.mark_skipped!(example,\n\"\#{hook_description} did not execute the example\")\nExtracted source (around line #628):\n626 627 628 629 630 631\ninitial_procsy = Example::Procsy.new(example) { yield }\nhooks.inject(initial_procsy) do |procsy, around_hook|\nprocsy.wrap { around_hook.execute_with(example, procsy) }\nend.call\nend\nExtracted source (around line #352):\n350 351 352 353 354 355\ndef call(*args, &block)\n@executed = true\n@proc.call(*args, &block)\nend\nalias run call\nExtracted source (around line #75):\n73 74 75 76 77 78\ngroup.around do |example|\nbefore_setup\nexample.run\nafter_teardown\nend\nend\nExtracted source (around line #457):\n455 456 457 458 459 460\n# @private\ndef instance_exec(*args, &block)\n@example_group_instance.instance_exec(*args, &block)\nend\nprivate\nExtracted source (around line #457):\n455 456 457 458 459 460\n# @private\ndef instance_exec(*args, &block)\n@example_group_instance.instance_exec(*args, &block)\nend\nprivate\nExtracted source (around line #390):\n388 389 390 391 392 393\nclass AroundHook < Hook\ndef execute_with(example, procsy)\nexample.instance_exec(procsy, &block)\nreturn if procsy.executed?\nPending.mark_skipped!(example,\n\"\#{hook_description} did not execute the example\")\nExtracted source (around line #628):\n626 627 628 629 630 631\ninitial_procsy = Example::Procsy.new(example) { yield }\nhooks.inject(initial_procsy) do |procsy, around_hook|\nprocsy.wrap { around_hook.execute_with(example, procsy) }\nend.call\nend\nExtracted source (around line #352):\n350 351 352 353 354 355\ndef call(*args, &block)\n@executed = true\n@proc.call(*args, &block)\nend\nalias run call\nExtracted source (around line #629):\n627 628 629 630 631 632\nhooks.inject(initial_procsy) do |procsy, around_hook|\nprocsy.wrap { around_hook.execute_with(example, procsy) }\nend.call\nend\nif respond_to?(:singleton_class) && singleton_class.ancestors.include?(singleton_class)\nExtracted source (around line #486):\n484 485 486 487 488 489\nwhen :before then run_example_hooks_for(example_or_group, :before, :reverse_each)\nwhen :after then run_example_hooks_for(example_or_group, :after, :each)\nwhen :around then run_around_example_hooks_for(example_or_group) { yield }\nend\nend\nend\nExtracted source (around line #468):\n466 467 468 469 470 471\ndef with_around_example_hooks\nRSpec.current_scope = :before_example_hook\nhooks.run(:around, :example, self) { yield }\nrescue Support::AllExceptionsExceptOnesWeMustNotRescue => e\nset_exception(e)\nend\nExtracted source (around line #511):\n509 510 511 512 513 514\nsingleton_context_hooks_host = example_group_instance.singleton_class\nsingleton_context_hooks_host.run_before_context_hooks(example_group_instance)\nwith_around_example_hooks { yield }\nensure\nsingleton_context_hooks_host.run_after_context_hooks(example_group_instance)\nend\nExtracted source (around line #259):\n257 258 259 260 261 262\nPending.mark_pending! self, skip\nelsif !RSpec.configuration.dry_run?\nwith_around_and_singleton_context_hooks do\nbegin\nrun_before_example\nRSpec.current_scope = :example\nExtracted source (around line #653):\n651 652 653 654 655 656\ninstance = new(example.inspect_output)\nset_ivars(instance, before_context_ivars)\nsucceeded = example.run(instance, reporter)\nif !succeeded && reporter.fail_fast_limit_met?\nRSpec.world.wants_to_quit = true\nend\nExtracted source (around line #649):\n647 648 649 650 651 652\n# @private\ndef self.run_examples(reporter)\nordering_strategy.order(filtered_examples).map do |example|\nnext if RSpec.world.wants_to_quit\ninstance = new(example.inspect_output)\nset_ivars(instance, before_context_ivars)\nExtracted source (around line #649):\n647 648 649 650 651 652\n# @private\ndef self.run_examples(reporter)\nordering_strategy.order(filtered_examples).map do |example|\nnext if RSpec.world.wants_to_quit\ninstance = new(example.inspect_output)\nset_ivars(instance, before_context_ivars)\nExtracted source (around line #614):\n612 613 614 615 616 617\nRSpec.current_scope = :before_context_hook\nrun_before_context_hooks(new('before(:context) hook')) if should_run_context_hooks\nresult_for_this_group = run_examples(reporter)\nresults_for_descendants = ordering_strategy.order(children).map { |child| child.run(reporter) }.all?\nresult_for_this_group && results_for_descendants\nrescue Pending::SkipDeclaredInExample => ex\nExtracted source (around line #615):\n613 614 615 616 617 618\nrun_before_context_hooks(new('before(:context) hook')) if should_run_context_hooks\nresult_for_this_group = run_examples(reporter)\nresults_for_descendants = ordering_strategy.order(children).map { |child| child.run(reporter) }.all?\nresult_for_this_group && results_for_descendants\nrescue Pending::SkipDeclaredInExample => ex\nfor_filtered_examples(reporter) { |example| example.skip_with_exception(reporter, ex) }\nExtracted source (around line #615):\n613 614 615 616 617 618\nrun_before_context_hooks(new('before(:context) hook')) if should_run_context_hooks\nresult_for_this_group = run_examples(reporter)\nresults_for_descendants = ordering_strategy.order(children).map { |child| child.run(reporter) }.all?\nresult_for_this_group && results_for_descendants\nrescue Pending::SkipDeclaredInExample => ex\nfor_filtered_examples(reporter) { |example| example.skip_with_exception(reporter, ex) }\nExtracted source (around line #615):\n613 614 615 616 617 618\nrun_before_context_hooks(new('before(:context) hook')) if should_run_context_hooks\nresult_for_this_group = run_examples(reporter)\nresults_for_descendants = ordering_strategy.order(children).map { |child| child.run(reporter) }.all?\nresult_for_this_group && results_for_descendants\nrescue Pending::SkipDeclaredInExample => ex\nfor_filtered_examples(reporter) { |example| example.skip_with_exception(reporter, ex) }\nExtracted source (around line #615):\n613 614 615 616 617 618\nrun_before_context_hooks(new('before(:context) hook')) if should_run_context_hooks\nresult_for_this_group = run_examples(reporter)\nresults_for_descendants = ordering_strategy.order(children).map { |child| child.run(reporter) }.all?\nresult_for_this_group && results_for_descendants\nrescue Pending::SkipDeclaredInExample => ex\nfor_filtered_examples(reporter) { |example| example.skip_with_exception(reporter, ex) }\nExtracted source (around line #615):\n613 614 615 616 617 618\nrun_before_context_hooks(new('before(:context) hook')) if should_run_context_hooks\nresult_for_this_group = run_examples(reporter)\nresults_for_descendants = ordering_strategy.order(children).map { |child| child.run(reporter) }.all?\nresult_for_this_group && results_for_descendants\nrescue Pending::SkipDeclaredInExample => ex\nfor_filtered_examples(reporter) { |example| example.skip_with_exception(reporter, ex) }\nExtracted source (around line #615):\n613 614 615 616 617 618\nrun_before_context_hooks(new('before(:context) hook')) if should_run_context_hooks\nresult_for_this_group = run_examples(reporter)\nresults_for_descendants = ordering_strategy.order(children).map { |child| child.run(reporter) }.all?\nresult_for_this_group && results_for_descendants\nrescue Pending::SkipDeclaredInExample => ex\nfor_filtered_examples(reporter) { |example| example.skip_with_exception(reporter, ex) }\nExtracted source (around line #121):\n119 120 121 122 123 124\nend\nexample_groups.map { |g| g.run(reporter) }.all?\nend\nend\nExtracted source (around line #121):\n119 120 121 122 123 124\nend\nexample_groups.map { |g| g.run(reporter) }.all?\nend\nend\nExtracted source (around line #121):\n119 120 121 122 123 124\nend\nexample_groups.map { |g| g.run(reporter) }.all?\nend\nend\nExtracted source (around line #2097):\n2095 2096 2097 2098 2099 2100\nRSpec.current_scope = :before_suite_hook\nrun_suite_hooks(\"a `before(:suite)` hook\", @before_suite_hooks)\nyield\nensure\nRSpec.current_scope = :after_suite_hook\nrun_suite_hooks(\"an `after(:suite)` hook\", @after_suite_hooks)\nExtracted source (around line #116):\n114 115 116 117 118 119\nexamples_count = @world.example_count(example_groups)\nexamples_passed = @configuration.reporter.report(examples_count) do |reporter|\n@configuration.with_suite_hooks do\nif examples_count == 0 && @configuration.fail_if_no_examples\nreturn @configuration.failure_exit_code\nend\nExtracted source (around line #74):\n72 73 74 75 76 77\nstart(expected_example_count)\nbegin\nyield self\nensure\nfinish\nend\nExtracted source (around line #115):\n113 114 115 116 117 118\ndef run_specs(example_groups)\nexamples_count = @world.example_count(example_groups)\nexamples_passed = @configuration.reporter.report(examples_count) do |reporter|\n@configuration.with_suite_hooks do\nif examples_count == 0 && @configuration.fail_if_no_examples\nreturn @configuration.failure_exit_code\nExtracted source (around line #89):\n87 88 89 90 91 92\nreturn @configuration.reporter.exit_early(exit_code) if RSpec.world.wants_to_quit\nrun_specs(@world.ordered_example_groups).tap do\npersist_example_statuses\nend\nend\nExtracted source (around line #71):\n69 70 71 72 73 74\noptions.options[:runner].call(options, err, out)\nelse\nnew(options).run(err, out)\nend\nend\nExtracted source (around line #45):\n43 44 45 46 47 48\ndef self.invoke\ndisable_autorun!\nstatus = run(ARGV, $stderr, $stdout).to_i\nexit(status) if status != 0\nend\nExtracted source (around line #4):\n2 3 4\nrequire 'rspec/core'\nRSpec::Core::Runner.invoke\nExtracted source (around line #25):\n23 24 25 26 27 28\nif Gem.respond_to?(:activate_bin_path)\nload Gem.activate_bin_path('rspec-core', 'rspec', version)\nelse\ngem \"rspec-core\", version\nload Gem.bin_path(\"rspec-core\", \"rspec\", version)\nExtracted source (around line #25):\n23 24 25 26 27 28\nif Gem.respond_to?(:activate_bin_path)\nload Gem.activate_bin_path('rspec-core', 'rspec', version)\nelse\ngem \"rspec-core\", version\nload Gem.bin_path(\"rspec-core\", \"rspec\", version)\nExtracted source (around line #58):\n56 57 58 59 60 61\nrequire_relative \"../setup\"\nTRAPPED_SIGNALS.each {|s| trap(s, \"DEFAULT\") }\nKernel.load(file)\nrescue SystemExit, SignalException\nraise\nrescue Exception # rubocop:disable Lint/RescueException\nExtracted source (around line #58):\n56 57 58 59 60 61\nrequire_relative \"../setup\"\nTRAPPED_SIGNALS.each {|s| trap(s, \"DEFAULT\") }\nKernel.load(file)\nrescue SystemExit, SignalException\nraise\nrescue Exception # rubocop:disable Lint/RescueException\nExtracted source (around line #23):\n21 22 23 24 25 26\nif bin_path = Bundler.which(cmd)\nif !Bundler.settings[:disable_exec_load] && ruby_shebang?(bin_path)\nreturn kernel_load(bin_path, *args)\nend\nkernel_exec(bin_path, *args)\nelse\nExtracted source (around line #492):\n490 491 492 493 494 495\nrequire_relative \"cli/exec\"\nExec.new(options, args).run\nend\nmap aliases_for(\"exec\")\nExtracted source (around line #27):\n25 26 27 28 29 30\nelsif public_method?(instance)\narity = instance.method(name).arity\ninstance.__send__(name, *args)\nelsif local_method?(instance, :method_missing)\ninstance.__send__(:method_missing, name.to_sym, *args)\nelse\nExtracted source (around line #127):\n125 126 127 128 129 130\nunless current.include?(command.name)\ncurrent << command.name\ncommand.run(self, *args)\nend\nend\nalias_method :invoke_task, :invoke_command\nExtracted source (around line #392):\n390 391 392 393 394 395\nargs = instance.args\ntrailing = args[Range.new(arguments.size, -1)]\ninstance.invoke_command(command, trailing || [])\nend\n# The banner for this class. You can customize it if you are invoking the\nExtracted source (around line #34):\n32 33 34 35 36 37\ndef self.dispatch(*)\nsuper do |i|\ni.send(:print_command)\ni.send(:warn_on_outdated_bundler)\nend\nExtracted source (around line #485):\n483 484 485 486 487 488\ndef start(given_args = ARGV, config = {})\nconfig[:shell] ||= Bundler::Thor::Base.shell.new\ndispatch(nil, given_args.dup, nil, config)\nrescue Bundler::Thor::Error => e\nconfig[:debug] || ENV[\"THOR_DEBUG\"] == \"1\" ? (raise e) : config[:shell].error(e.message)\nexit(false) if exit_on_failure?\nExtracted source (around line #28):\n26 27 28 29 30 31\ncheck_deprecated_ext_option(ARGV) if ARGV.include?(\"--ext\")\nsuper\nensure\nBundler::SharedHelpers.print_major_deprecations!\nend\nExtracted source (around line #37):\n35 36 37 38\nargs = help_flag_used ? Bundler::CLI.reformatted_help_args(ARGV) : ARGV\nBundler::CLI.start(args, :debug => true)\nend\nExtracted source (around line #117):\n115 116 117 118 119 120\ndef self.with_friendly_errors\nFriendlyErrors.enable!\nyield\nrescue SignalException\nraise\nrescue Exception => e # rubocop:disable Lint/RescueException\nExtracted source (around line #29):\n27 28 29 30 31 32\nrequire \"bundler/friendly_errors\"\nBundler.with_friendly_errors do\nrequire \"bundler/cli\"\n# Allow any command to use --help flag to show help for that command\nExtracted source (around line #25):\n23 24 25 26 27 28\nif Gem.respond_to?(:activate_bin_path)\nload Gem.activate_bin_path('bundler', 'bundle', version)\nelse\ngem \"bundler\", version\nload Gem.bin_path(\"bundler\", \"bundle\", version)\nExtracted source (around line #25):\n23 24 25 26 27 28\nif Gem.respond_to?(:activate_bin_path)\nload Gem.activate_bin_path('bundler', 'bundle', version)\nelse\ngem \"bundler\", version\nload Gem.bin_path(\"bundler\", \"bundle\", version)\nRails.root: /rails\nApplication Trace | Framework Trace | Full Trace\nactionpack (7.2.3) lib/action_controller/metal/request_forgery_protection.rb:314:in `handle_unverified_request' actionpack (7.2.3) lib/action_controller/metal/request_forgery_protection.rb:408:in `handle_unverified_request' devise (4.9.4) lib/devise/controllers/helpers.rb:257:in `handle_unverified_request' actionpack (7.2.3) lib/action_controller/metal/request_forgery_protection.rb:397:in `verify_authenticity_token' activesupport (7.2.3) lib/active_support/callbacks.rb:362:in `block in make_lambda' activesupport (7.2.3) lib/active_support/callbacks.rb:179:in `block in call' actionpack (7.2.3) lib/abstract_controller/callbacks.rb:34:in `block (2 levels) in <module:Callbacks>' activesupport (7.2.3) lib/active_support/callbacks.rb:180:in `call' activesupport (7.2.3) lib/active_support/callbacks.rb:560:in `block in invoke_before' activesupport (7.2.3) lib/active_support/callbacks.rb:560:in `each' activesupport (7.2.3) lib/active_support/callbacks.rb:560:in `invoke_before' activesupport (7.2.3) lib/active_support/callbacks.rb:119:in `block in run_callbacks' activesupport (7.2.3) lib/active_support/callbacks.rb:141:in `run_callbacks' actionpack (7.2.3) lib/abstract_controller/callbacks.rb:260:in `process_action' actionpack (7.2.3) lib/action_controller/metal/rescue.rb:27:in `process_action' actionpack (7.2.3) lib/action_controller/metal/instrumentation.rb:77:in `block in process_action' activesupport (7.2.3) lib/active_support/notifications.rb:210:in `block in instrument' activesupport (7.2.3) lib/active_support/notifications/instrumenter.rb:58:in `instrument' activesupport (7.2.3) lib/active_support/notifications.rb:210:in `instrument' actionpack (7.2.3) lib/action_controller/metal/instrumentation.rb:76:in `process_action' actionpack (7.2.3) lib/action_controller/metal/params_wrapper.rb:259:in `process_action' activerecord (7.2.3) lib/active_record/railties/controller_runtime.rb:39:in `process_action' actionpack (7.2.3) lib/abstract_controller/base.rb:152:in `process' actionview (7.2.3) lib/action_view/rendering.rb:40:in `process' actionpack (7.2.3) lib/action_controller/metal.rb:252:in `dispatch' actionpack (7.2.3) lib/action_controller/metal.rb:335:in `dispatch' actionpack (7.2.3) lib/action_dispatch/routing/route_set.rb:67:in `dispatch' actionpack (7.2.3) lib/action_dispatch/routing/route_set.rb:50:in `serve' actionpack (7.2.3) lib/action_dispatch/journey/router.rb:53:in `block in serve' actionpack (7.2.3) lib/action_dispatch/journey/router.rb:133:in `block in find_routes' actionpack (7.2.3) lib/action_dispatch/journey/router.rb:126:in `each' actionpack (7.2.3) lib/action_dispatch/journey/router.rb:126:in `find_routes' actionpack (7.2.3) lib/action_dispatch/journey/router.rb:34:in `serve' actionpack (7.2.3) lib/action_dispatch/routing/route_set.rb:896:in `call' omniauth (2.1.4) lib/omniauth/strategy.rb:202:in `call!' omniauth (2.1.4) lib/omniauth/strategy.rb:169:in `call' warden (1.2.9) lib/warden/manager.rb:36:in `block in call' warden (1.2.9) lib/warden/manager.rb:34:in `catch' warden (1.2.9) lib/warden/manager.rb:34:in `call' rack (3.2.4) lib/rack/tempfile_reaper.rb:20:in `call' rack (3.2.4) lib/rack/etag.rb:29:in `call' rack (3.2.4) lib/rack/conditional_get.rb:44:in `call' rack (3.2.4) lib/rack/head.rb:15:in `call' actionpack (7.2.3) lib/action_dispatch/http/permissions_policy.rb:38:in `call' actionpack (7.2.3) lib/action_dispatch/http/content_security_policy.rb:38:in `call' rack-session (2.1.1) lib/rack/session/abstract/id.rb:274:in `context' rack-session (2.1.1) lib/rack/session/abstract/id.rb:268:in `call' actionpack (7.2.3) lib/action_dispatch/middleware/cookies.rb:704:in `call' activerecord (7.2.3) lib/active_record/migration.rb:674:in `call' actionpack (7.2.3) lib/action_dispatch/middleware/callbacks.rb:31:in `block in call' activesupport (7.2.3) lib/active_support/callbacks.rb:101:in `run_callbacks' actionpack (7.2.3) lib/action_dispatch/middleware/callbacks.rb:30:in `call' actionpack (7.2.3) lib/action_dispatch/middleware/executor.rb:16:in `call' actionpack (7.2.3) lib/action_dispatch/middleware/actionable_exceptions.rb:18:in `call' actionpack (7.2.3) lib/action_dispatch/middleware/debug_exceptions.rb:31:in `call' web-console (4.2.1) lib/web_console/middleware.rb:132:in `call_app' web-console (4.2.1) lib/web_console/middleware.rb:28:in `block in call' web-console (4.2.1) lib/web_console/middleware.rb:17:in `catch' web-console (4.2.1) lib/web_console/middleware.rb:17:in `call' actionpack (7.2.3) lib/action_dispatch/middleware/show_exceptions.rb:32:in `call' railties (7.2.3) lib/rails/rack/logger.rb:41:in `call_app' railties (7.2.3) lib/rails/rack/logger.rb:29:in `call' sprockets-rails (3.5.2) lib/sprockets/rails/quiet_assets.rb:17:in `call' actionpack (7.2.3) lib/action_dispatch/middleware/remote_ip.rb:96:in `call' actionpack (7.2.3) lib/action_dispatch/middleware/request_id.rb:33:in `call' rack (3.2.4) lib/rack/method_override.rb:28:in `call' rack (3.2.4) lib/rack/runtime.rb:24:in `call' activesupport (7.2.3) lib/active_support/cache/strategy/local_cache_middleware.rb:29:in `call' actionpack (7.2.3) lib/action_dispatch/middleware/server_timing.rb:61:in `block in call' actionpack (7.2.3) lib/action_dispatch/middleware/server_timing.rb:26:in `collect_events' actionpack (7.2.3) lib/action_dispatch/middleware/server_timing.rb:60:in `call' actionpack (7.2.3) lib/action_dispatch/middleware/executor.rb:16:in `call' actionpack (7.2.3) lib/action_dispatch/middleware/static.rb:27:in `call' rack (3.2.4) lib/rack/sendfile.rb:131:in `call' actionpack (7.2.3) lib/action_dispatch/middleware/host_authorization.rb:143:in `call' railties (7.2.3) lib/rails/engine.rb:535:in `call' rack (3.2.4) lib/rack/urlmap.rb:76:in `block in call' rack (3.2.4) lib/rack/urlmap.rb:60:in `each' rack (3.2.4) lib/rack/urlmap.rb:60:in `call' rack (3.2.4) lib/rack/builder.rb:283:in `call' rack-test (2.2.0) lib/rack/test.rb:360:in `process_request' rack-test (2.2.0) lib/rack/test.rb:163:in `custom_request' rack-test (2.2.0) lib/rack/test.rb:112:in `post' /usr/local/lib/ruby/3.2.0/forwardable.rb:240:in `post' capybara (3.40.0) lib/capybara/rack_test/browser.rb:81:in `process' capybara (3.40.0) lib/capybara/rack_test/browser.rb:56:in `process_and_follow_redirects' capybara (3.40.0) lib/capybara/rack_test/browser.rb:40:in `submit' capybara (3.40.0) lib/capybara/rack_test/form.rb:57:in `submit' capybara (3.40.0) lib/capybara/rack_test/node.rb:69:in `click' capybara (3.40.0) lib/capybara/rack_test/node.rb:131:in `call' capybara (3.40.0) lib/capybara/rack_test/node.rb:131:in `click' capybara (3.40.0) lib/capybara/node/element.rb:172:in `block in click' capybara (3.40.0) lib/capybara/node/element.rb:608:in `block in perform_click_action' capybara (3.40.0) lib/capybara/node/base.rb:84:in `synchronize' capybara (3.40.0) lib/capybara/node/element.rb:608:in `perform_click_action' capybara (3.40.0) lib/capybara/node/element.rb:171:in `click' capybara (3.40.0) lib/capybara/node/actions.rb:58:in `click_button' capybara (3.40.0) lib/capybara/session.rb:774:in `click_button' capybara (3.40.0) lib/capybara/dsl.rb:52:in `call' capybara (3.40.0) lib/capybara/dsl.rb:52:in `click_button' spec/system/walks_spec.rb:41:in `block (4 levels) in <top (required)>' rspec-core (3.13.6) lib/rspec/core/example.rb:263:in `instance_exec' rspec-core (3.13.6) lib/rspec/core/example.rb:263:in `block in run' rspec-core (3.13.6) lib/rspec/core/example.rb:511:in `block in with_around_and_singleton_context_hooks' rspec-core (3.13.6) lib/rspec/core/example.rb:468:in `block in with_around_example_hooks' rspec-core (3.13.6) lib/rspec/core/hooks.rb:486:in `block in run' rspec-core (3.13.6) lib/rspec/core/hooks.rb:626:in `block in run_around_example_hooks_for' rspec-core (3.13.6) lib/rspec/core/example.rb:352:in `call' rspec-rails (8.0.2) lib/rspec/rails/example/system_example_group.rb:171:in `block (2 levels) in <module:SystemExampleGroup>' rspec-core (3.13.6) lib/rspec/core/example.rb:457:in `instance_exec' rspec-core (3.13.6) lib/rspec/core/example.rb:457:in `instance_exec' rspec-core (3.13.6) lib/rspec/core/hooks.rb:390:in `execute_with' rspec-core (3.13.6) lib/rspec/core/hooks.rb:628:in `block (2 levels) in run_around_example_hooks_for' rspec-core (3.13.6) lib/rspec/core/example.rb:352:in `call' rspec-rails (8.0.2) lib/rspec/rails/adapters.rb:75:in `block (2 levels) in <module:MinitestLifecycleAdapter>' rspec-core (3.13.6) lib/rspec/core/example.rb:457:in `instance_exec' rspec-core (3.13.6) lib/rspec/core/example.rb:457:in `instance_exec' rspec-core (3.13.6) lib/rspec/core/hooks.rb:390:in `execute_with' rspec-core (3.13.6) lib/rspec/core/hooks.rb:628:in `block (2 levels) in run_around_example_hooks_for' rspec-core (3.13.6) lib/rspec/core/example.rb:352:in `call' rspec-core (3.13.6) lib/rspec/core/hooks.rb:629:in `run_around_example_hooks_for' rspec-core (3.13.6) lib/rspec/core/hooks.rb:486:in `run' rspec-core (3.13.6) lib/rspec/core/example.rb:468:in `with_around_example_hooks' rspec-core (3.13.6) lib/rspec/core/example.rb:511:in `with_around_and_singleton_context_hooks' rspec-core (3.13.6) lib/rspec/core/example.rb:259:in `run' rspec-core (3.13.6) lib/rspec/core/example_group.rb:653:in `block in run_examples' rspec-core (3.13.6) lib/rspec/core/example_group.rb:649:in `map' rspec-core (3.13.6) lib/rspec/core/example_group.rb:649:in `run_examples' rspec-core (3.13.6) lib/rspec/core/example_group.rb:614:in `run' rspec-core (3.13.6) lib/rspec/core/example_group.rb:615:in `block in run' rspec-core (3.13.6) lib/rspec/core/example_group.rb:615:in `map' rspec-core (3.13.6) lib/rspec/core/example_group.rb:615:in `run' rspec-core (3.13.6) lib/rspec/core/example_group.rb:615:in `block in run' rspec-core (3.13.6) lib/rspec/core/example_group.rb:615:in `map' rspec-core (3.13.6) lib/rspec/core/example_group.rb:615:in `run' rspec-core (3.13.6) lib/rspec/core/runner.rb:121:in `block (3 levels) in run_specs' rspec-core (3.13.6) lib/rspec/core/runner.rb:121:in `map' rspec-core (3.13.6) lib/rspec/core/runner.rb:121:in `block (2 levels) in run_specs' rspec-core (3.13.6) lib/rspec/core/configuration.rb:2097:in `with_suite_hooks' rspec-core (3.13.6) lib/rspec/core/runner.rb:116:in `block in run_specs' rspec-core (3.13.6) lib/rspec/core/reporter.rb:74:in `report' rspec-core (3.13.6) lib/rspec/core/runner.rb:115:in `run_specs' rspec-core (3.13.6) lib/rspec/core/runner.rb:89:in `run' rspec-core (3.13.6) lib/rspec/core/runner.rb:71:in `run' rspec-core (3.13.6) lib/rspec/core/runner.rb:45:in `invoke' rspec-core (3.13.6) exe/rspec:4:in `<top (required)>' /usr/local/bundle/bin/rspec:25:in `load' /usr/local/bundle/bin/rspec:25:in `<top (required)>' bundler (2.4.20) lib/bundler/cli/exec.rb:58:in `load' bundler (2.4.20) lib/bundler/cli/exec.rb:58:in `kernel_load' bundler (2.4.20) lib/bundler/cli/exec.rb:23:in `run' bundler (2.4.20) lib/bundler/cli.rb:492:in `exec' bundler (2.4.20) lib/bundler/vendor/thor/lib/thor/command.rb:27:in `run' bundler (2.4.20) lib/bundler/vendor/thor/lib/thor/invocation.rb:127:in `invoke_command' bundler (2.4.20) lib/bundler/vendor/thor/lib/thor.rb:392:in `dispatch' bundler (2.4.20) lib/bundler/cli.rb:34:in `dispatch' bundler (2.4.20) lib/bundler/vendor/thor/lib/thor/base.rb:485:in `start' bundler (2.4.20) lib/bundler/cli.rb:28:in `start' bundler (2.4.20) exe/bundle:37:in `block in <top (required)>' bundler (2.4.20) lib/bundler/friendly_errors.rb:117:in `with_friendly_errors' bundler (2.4.20) exe/bundle:29:in `<top (required)>' /usr/local/bundle/bin/bundle:25:in `load' /usr/local/bundle/bin/bundle:25:in `<main>'\nRequest\nParameters:\n{\"authenticity_token\"=>\"[FILTERED]\", \"walk\"=>{\"walked_on\"=>\"2025-11-21\", \"location\"=>\"テスト公園\", \"distance\"=>\"5.5\", \"duration\"=>\"60\", \"steps\"=>\"8000\", \"calories_burned\"=>\"300\", \"notes\"=>\"テスト散歩の記録です\"}, \"commit\"=>\"散歩記録を保存\"}\nToggle session dump\n_csrf_token: \"9dg9NEyGoN_SLq-Eh_cgmyKzYaifHliMzBYxkLV_xW0\" session_id: \"b9861ff0abc7eec85863a376f6c7eda3\" warden.user.user.key: [[12], \"$2a$12$y/Y.gQCnTmNK0c3NFvhLze\"]\nToggle env dump\nORIGINAL_SCRIPT_NAME: \"\" REMOTE_ADDR: \"127.0.0.1\" SERVER_NAME: \"localhost\" SERVER_PROTOCOL: \"HTTP/1.0\"\nResponse\nHeaders:\nNone"
     # ./spec/system/walks_spec.rb:46:in `block (4 levels) in <top (required)>'

Finished in 2.24 seconds (files took 2.01 seconds to load)
1 example, 1 failure

Failed examples:

rspec ./spec/system/walks_spec.rb:25 # Walks 散歩記録の新規作成 フォームに正常な値を入力した場合 散歩記録が保存され、一覧画面に表示されること

