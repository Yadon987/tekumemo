# Issue#14: 【拡散】OGP 設定と SNS シェア機能の実装

## 概要

アプリ内のコンテンツ（ユーザーの投稿）が外部 SNS（X 等）でシェアされた際に、
魅力的なプレビュー画像（OGP）が表示されるようにし、新規ユーザーの流入を促進する。

## 実装内容

- [x] OGP タグの基本設定（Rails の標準機能を使用、meta-tags gem は不使用）
- [ ] ~~静的 OGP 画像の設定（トップページ用）~~ ※動的生成のみで対応
- [x] 動的 OGP 画像の生成機能
  - [x] MiniMagick を使用した RPG 風ステータス画面デザインの実装
  - [x] 投稿詳細ページ (`/posts/:id`) で投稿内容を反映した画像を動的に生成
  - [x] ユーザーアバター（Google アバター or イニシャルアイコン）の表示
  - [x] ユーザー名、Lv、投稿本文、歩数、距離、EXP、ロケーション情報の表示
  - [x] 日本語フォント対応（MPLUS1p-Bold, NotoSansJP-Bold）
  - [x] デフォルトメッセージの実装（投稿本文が空の場合）
  - [x] 絵文字の除去処理
  - [x] 長いテキストの自動折り返し処理
- [x] シェアボタンの設置
  - [x] 投稿一覧画面に X へのシェアボタンを配置
  - [x] シェア用テキストの自動生成（投稿本文 + ハッシュタグ）
  - [ ] ~~LINE, Facebook へのシェアボタン~~ ※X のみ実装
- [x] OGP 画像生成 API エンドポイントの実装 (`/posts/:id/ogp_image`)
- [x] セキュリティ対策（Brakeman でのコマンドインジェクション警告の解消）
- [x] テスト環境の最適化（Google Fonts の読み込みスキップによる高速化）
- [x] システムスペックとリクエストスペックの追加

## 受け入れ条件

- [x] 投稿詳細ページを SNS でシェアした際、その投稿の内容が反映された RPG 風画像が表示されること
- [x] シェアボタンをクリックすると、適切なテキストが入った状態で X の投稿画面が開くこと
- [x] ユーザーの Google アバターがある場合は表示され、ない場合はイニシャルアイコンが表示されること
- [x] 全てのテストが成功すること（268 examples, 0 failures）
- [x] セキュリティスキャン（Brakeman）で警告が出ないこと
- [ ] Twitter Card Validator での表示確認（本番環境デプロイ後）

## 実装の変更点

### 当初の計画からの変更

- **meta-tags gem**: 不使用（Rails の標準機能で十分対応可能なため）
- **Grover/Puppeteer**: 廃止（Render.com でのデプロイ時のビルドエラーと複雑性のため）
- **MiniMagick 採用**: ImageMagick を使用したシンプルで軽量な画像生成に変更
- **デザイン**: RPG ステータス画面風の独自デザインを実装

## 実装時間

実績: 約 12 時間（見積もり通り）

## 技術スタック

- Rails 7
- MiniMagick (画像生成)
- ImageMagick (画像処理エンジン)
- Google Fonts（本番環境のみ、テスト環境ではスキップ）

## デプロイメモ

- Render.com のビルドスクリプト更新済み (`bin/render-build.sh`)
- ImageMagick とフォントファイル (`/public/fonts/`) のデプロイが必要
