<div class="space-y-6">
  <!-- „Éö„Éº„Ç∏„Çø„Ç§„Éà„É´ -->
  <div class="flex justify-between items-center">
    <h1 class="text-2xl font-bold text-gray-900 dark:text-white flex items-center">
      <span class="material-symbols-outlined mr-2 text-3xl">dashboard</span>
      ÁÆ°ÁêÜËÄÖ„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ
    </h1>
    <div class="text-sm text-gray-500 dark:text-gray-400">
      <%= l Time.current, format: :long %>
    </div>
  </div>

  <!-- Áµ±Ë®à„Ç´„Éº„ÉâÁæ§ -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
    <!-- Á∑è„É¶„Éº„Ç∂„ÉºÊï∞ -->
    <div class="bg-white dark:bg-slate-800 rounded-lg shadow p-6">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm text-gray-500 dark:text-gray-400">Á∑è„É¶„Éº„Ç∂„ÉºÊï∞</p>
          <p class="text-3xl font-bold text-gray-900 dark:text-white mt-2"><%= @total_users %></p>
          <p class="text-xs text-green-600 dark:text-green-400 mt-1">
            ‰ªäÊúà +<%= @users_this_month %>
          </p>
        </div>
        <div class="bg-blue-100 dark:bg-blue-900/30 rounded-full p-3">
          <span class="material-symbols-outlined text-3xl text-blue-600 dark:text-blue-400">group</span>
        </div>
      </div>
    </div>

    <!-- Á∑èÊäïÁ®øÊï∞ -->
    <div class="bg-white dark:bg-slate-800 rounded-lg shadow p-6">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm text-gray-500 dark:text-gray-400">Á∑èÊäïÁ®øÊï∞</p>
          <p class="text-3xl font-bold text-gray-900 dark:text-white mt-2"><%= @total_posts %></p>
          <p class="text-xs text-green-600 dark:text-green-400 mt-1">
            ‰ªäÊó• +<%= @posts_today %>
          </p>
        </div>
        <div class="bg-purple-100 dark:bg-purple-900/30 rounded-full p-3">
          <span class="material-symbols-outlined text-3xl text-purple-600 dark:text-purple-400">edit_square</span>
        </div>
      </div>
    </div>

    <!-- Á∑èÊï£Ê≠©Ë∑ùÈõ¢ -->
    <div class="bg-white dark:bg-slate-800 rounded-lg shadow p-6">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm text-gray-500 dark:text-gray-400">Á∑èÊï£Ê≠©Ë∑ùÈõ¢</p>
          <p class="text-3xl font-bold text-gray-900 dark:text-white mt-2">
            <%= number_with_delimiter(@total_distance.round(1)) %>
            <span class="text-lg">km</span>
          </p>
          <p class="text-xs text-green-600 dark:text-green-400 mt-1">
            ‰ªäÊúà <%= number_with_delimiter(@distance_this_month.round(1)) %>km
          </p>
        </div>
        <div class="bg-green-100 dark:bg-green-900/30 rounded-full p-3">
          <span class="material-symbols-outlined text-3xl text-green-600 dark:text-green-400">footprint</span>
        </div>
      </div>
    </div>

    <!-- „Ç¢„ÇØ„ÉÜ„Ç£„Éñ„É¶„Éº„Ç∂„Éº -->
    <div class="bg-white dark:bg-slate-800 rounded-lg shadow p-6">
      <div class="flex items-center justify-between mb-3">
        <div>
          <p class="text-sm text-gray-500 dark:text-gray-400">„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„É¶„Éº„Ç∂„Éº</p>
          <p class="text-3xl font-bold text-gray-900 dark:text-white mt-2"><%= @active_users_this_month %></p>
          <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
            ‰ªäÊó•: <%= @active_users_today %> / ‰ªäÈÄ±: <%= @active_users_this_week %>
          </p>
        </div>
        <div class="bg-orange-100 dark:bg-orange-900/30 rounded-full p-3">
          <span class="material-symbols-outlined text-3xl text-orange-600 dark:text-orange-400">monitoring</span>
        </div>
      </div>

      <!-- ‰ªäÊó•„ÅÆ„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„É¶„Éº„Ç∂„ÉºÂêçË°®Á§∫ -->
      <% if @active_users_today_list.any? %>
        <div class="mt-3 pt-3 border-t border-gray-200 dark:border-gray-700">
          <p class="text-xs text-gray-500 dark:text-gray-400 mb-1">‰ªäÊó•„ÅÆ„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„É¶„Éº„Ç∂„Éº:</p>
          <div class="flex flex-wrap gap-1">
            <% @active_users_today_list.take(3).each do |user_name| %>
              <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-300">
                <%= user_name %>
              </span>
            <% end %>
            <% if @active_users_today > 3 %>
              <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400">
                ‰ªñ<%= @active_users_today - 3 %>Âêç
              </span>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Áï∞Â∏∏Ê§úÁü•„Çª„ÇØ„Ç∑„Éß„É≥ -->
  <div class="bg-white dark:bg-slate-800 rounded-lg shadow overflow-hidden" data-controller="anomaly">
    <!-- „Éà„Ç∞„É´„Éò„ÉÉ„ÉÄ„Éº -->
    <button
      type="button"
      data-action="click->anomaly#toggle"
      class="w-full px-6 py-4 flex items-center justify-between <%= @total_anomalies > 0 ? 'bg-red-50 dark:bg-red-900/20 hover:bg-red-100 dark:hover:bg-red-900/30' : 'bg-green-50 dark:bg-green-900/20 hover:bg-green-100 dark:hover:bg-green-900/30' %> transition-colors"
    >
      <div class="flex items-center space-x-3">
        <% if @total_anomalies > 0 %>
          <!-- Áï∞Â∏∏„ÅÇ„ÇäÔºöËµ§„ÅÑ„Éë„É´„Çπ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ -->
          <div class="relative">
            <span class="material-symbols-outlined text-2xl text-red-600 dark:text-red-400 relative z-10">warning</span>
            <span class="absolute inset-0 animate-ping">
              <span class="material-symbols-outlined text-2xl text-red-600 dark:text-red-400 opacity-75">warning</span>
            </span>
          </div>
          <div>
            <h2 class="text-lg font-bold text-red-800 dark:text-red-300">
              ‚ö†Ô∏è „Ç∑„Çπ„ÉÜ„É†Áï∞Â∏∏Ê§úÂá∫
            </h2>
            <p class="text-sm text-red-600 dark:text-red-400">
              <%= @total_anomalies %> ‰ª∂„ÅÆÁï∞Â∏∏„ÅåÊ§úÂá∫„Åï„Çå„Åæ„Åó„Åü
            </p>
          </div>
        <% else %>
          <!-- Ê≠£Â∏∏ÔºöÁ∑ëËâ≤„ÅÆ„Ç∞„É≠„Éº -->
          <div class="relative">
            <span class="material-symbols-outlined text-2xl text-green-600 dark:text-green-400 drop-shadow-[0_0_8px_rgba(34,197,94,0.5)]">check_circle</span>
          </div>
          <div>
            <h2 class="text-lg font-bold text-green-800 dark:text-green-300">
              ‚úì „Ç∑„Çπ„ÉÜ„É†Ê≠£Â∏∏
            </h2>
            <p class="text-sm text-green-600 dark:text-green-400">
              Áï∞Â∏∏„ÅØÊ§úÂá∫„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì
            </p>
          </div>
        <% end %>
      </div>

      <!-- ÈñãÈñâ„Ç¢„Ç§„Ç≥„É≥ -->
      <span class="material-symbols-outlined text-gray-400">expand_more</span>
    </button>

    <!-- Áï∞Â∏∏Ë©≥Á¥∞ÔºàÈñãÈñâÂºèÔºâ -->
    <div data-anomaly-target="content" class="hidden">
      <% if @total_anomalies > 0 %>
        <div class="px-6 py-4 space-y-6">
          <!-- 1. „Çπ„Éë„É†Áñë„ÅÑ„É¶„Éº„Ç∂„Éº -->
          <% if @anomalies[:spam_users].any? %>
            <div>
              <h3 class="text-md font-bold text-red-700 dark:text-red-300 flex items-center mb-3">
                <span class="material-symbols-outlined mr-2">report</span>
                üö® „Çπ„Éë„É†Áñë„ÅÑ„É¶„Éº„Ç∂„ÉºÔºà<%= @anomalies[:spam_users].count %>‰ª∂Ôºâ
              </h3>
              <div class="space-y-2">
                <% @anomalies[:spam_users].each do |user| %>
                  <div class="flex items-center justify-between p-3 bg-red-50 dark:bg-red-900/10 rounded-lg border border-red-200 dark:border-red-800">
                    <div class="flex items-center space-x-3">
                      <%= user_avatar(user, classes: "h-10 w-10 rounded-full") %>
                      <div>
                        <p class="text-sm font-medium text-gray-900 dark:text-white"><%= user.name %></p>
                        <p class="text-xs text-gray-500 dark:text-gray-400">
                          Áü≠ÊúüÈñì„Å´ <%= user.try(:post_count) || 'Â§ßÈáè' %> ‰ª∂ÊäïÁ®ø
                        </p>
                      </div>
                    </div>
                    <%= link_to "Ë©≥Á¥∞", admin_users_path(q: user.email), class: "text-sm text-blue-600 hover:text-blue-700 dark:text-blue-400" %>
                  </div>
                <% end %>
              </div>
            </div>
          <% end %>

          <!-- 2. „Éá„Éº„ÇøÊï¥ÂêàÊÄß„Ç®„É©„Éº -->
          <% if @anomalies[:invalid_walks].any? %>
            <div>
              <h3 class="text-md font-bold text-orange-700 dark:text-orange-300 flex items-center mb-3">
                <span class="material-symbols-outlined mr-2">error</span>
                üìä „Éá„Éº„ÇøÊï¥ÂêàÊÄß„Ç®„É©„ÉºÔºà<%= @anomalies[:invalid_walks].count %>‰ª∂Ôºâ
              </h3>
              <div class="space-y-2">
                <% @anomalies[:invalid_walks].each do |walk| %>
                  <div class="flex items-center justify-between p-3 bg-orange-50 dark:bg-orange-900/10 rounded-lg border border-orange-200 dark:border-orange-800">
                    <div class="flex items-center space-x-3">
                      <%= user_avatar(walk.user, classes: "h-10 w-10 rounded-full") %>
                      <div>
                        <p class="text-sm font-medium text-gray-900 dark:text-white"><%= walk.user.name %></p>
                        <p class="text-xs text-gray-500 dark:text-gray-400">
                          Ë∑ùÈõ¢: <%= number_with_delimiter(walk.distance) %>m / Ê≠©Êï∞: <%= number_with_delimiter(walk.steps || 0) %>Ê≠©
                        </p>
                      </div>
                    </div>
                    <%= link_to "Ë©≥Á¥∞", admin_walk_path(walk), class: "text-sm text-blue-600 hover:text-blue-700 dark:text-blue-400" %>
                  </div>
                <% end %>
              </div>
            </div>
          <% end %>

          <!-- 3. „Çª„Ç≠„É•„É™„ÉÜ„Ç£Êá∏Âøµ -->
          <% if @anomalies[:security_concern].any? %>
            <div>
              <h3 class="text-md font-bold text-yellow-700 dark:text-yellow-300 flex items-center mb-3">
                <span class="material-symbols-outlined mr-2">security</span>
                üîí „Çª„Ç≠„É•„É™„ÉÜ„Ç£Êá∏ÂøµÔºà<%= @anomalies[:security_concern].count %>‰ª∂Ôºâ
              </h3>
              <div class="space-y-2">
                <% @anomalies[:security_concern].each do |user| %>
                  <div class="flex items-center justify-between p-3 bg-yellow-50 dark:bg-yellow-900/10 rounded-lg border border-yellow-200 dark:border-yellow-800">
                    <div class="flex items-center space-x-3">
                      <%= user_avatar(user, classes: "h-10 w-10 rounded-full") %>
                      <div>
                        <p class="text-sm font-medium text-gray-900 dark:text-white"><%= user.name %></p>
                        <p class="text-xs text-gray-500 dark:text-gray-400">
                          ÊúÄÁµÇ„É≠„Ç∞„Ç§„É≥: <%= time_ago_in_words_game_style(user.current_sign_in_at) %> / ÊúÄËøëÊäïÁ®ø„ÅÇ„Çä
                        </p>
                      </div>
                    </div>
                    <%= link_to "Ë©≥Á¥∞", admin_users_path(q: user.email), class: "text-sm text-blue-600 hover:text-blue-700 dark:text-blue-400" %>
                  </div>
                <% end %>
              </div>
            </div>
          <% end %>

          <!-- 4. Èùû„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Ç¢„Ç´„Ç¶„É≥„Éà -->
          <% if @anomalies[:inactive_accounts].any? %>
            <div>
              <h3 class="text-md font-bold text-gray-700 dark:text-gray-300 flex items-center mb-3">
                <span class="material-symbols-outlined mr-2">person_off</span>
                üóëÔ∏è Èùû„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Ç¢„Ç´„Ç¶„É≥„ÉàÔºà<%= @anomalies[:inactive_accounts].count %>‰ª∂Ôºâ
              </h3>
              <div class="space-y-2">
                <% @anomalies[:inactive_accounts].each do |user| %>
                  <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600">
                    <div class="flex items-center space-x-3">
                      <%= user_avatar(user, classes: "h-10 w-10 rounded-full") %>
                      <div>
                        <p class="text-sm font-medium text-gray-900 dark:text-white"><%= user.name %></p>
                        <p class="text-xs text-gray-500 dark:text-gray-400">
                          ÁôªÈå≤: <%= time_ago_in_words_game_style(user.created_at) %> / Ê¥ªÂãï„Å™„Åó
                        </p>
                      </div>
                    </div>
                    <%= link_to "Ë©≥Á¥∞", admin_users_path(q: user.email), class: "text-sm text-blue-600 hover:text-blue-700 dark:text-blue-400" %>
                  </div>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <div class="px-6 py-8 text-center">
          <p class="text-green-600 dark:text-green-400">
            „Åô„Åπ„Å¶„ÅÆ„Ç∑„Çπ„ÉÜ„É†„ÅåÊ≠£Â∏∏„Å´Âãï‰Ωú„Åó„Å¶„ÅÑ„Åæ„Åô
          </p>
        </div>
      <% end %>
    </div>
  </div>

  <!-- 2„Ç´„É©„É†„Ç∞„É™„ÉÉ„Éâ -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- ‰∫∫Ê∞óÊäïÁ®ø -->
    <div class="bg-white dark:bg-slate-800 rounded-lg shadow">
      <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
        <h2 class="text-lg font-bold text-gray-900 dark:text-white flex items-center">
          <span class="material-symbols-outlined mr-2">trending_up</span>
          ‰∫∫Ê∞ó„ÅÆÊäïÁ®ø TOP5
        </h2>
      </div>
      <div class="p-6 relative">
        <% if current_user.guest? %>
          <div class="absolute inset-0 z-10 flex items-center justify-center bg-white/10 dark:bg-slate-900/10 rounded-b-lg">
            <div class="px-4 py-2 bg-slate-800/90 text-white text-sm font-bold rounded-lg shadow-lg flex items-center space-x-2 backdrop-blur-md">
              <span class="material-symbols-outlined text-base">lock</span>
              <span>„Ç≤„Çπ„ÉàÈñ≤Ë¶ß„É¢„Éº„ÉâÔºà‰øùË≠∑‰∏≠Ôºâ</span>
            </div>
          </div>
        <% end %>

        <div class="<%= 'blur-[3px] pointer-events-none select-none opacity-80' if current_user.guest? %>">
          <% if @popular_posts.any? %>
            <div class="space-y-4">
              <% @popular_posts.each do |post| %>
                <div class="flex items-start space-x-3 p-3 bg-gray-50 dark:bg-slate-700 rounded-lg">
                  <%= user_avatar(post.user, classes: "h-10 w-10 rounded-full flex-shrink-0") %>
                  <div class="flex-1 min-w-0">
                    <div class="flex items-center justify-between">
                      <p class="text-sm font-medium text-gray-900 dark:text-white truncate">
                        <%= post.user.name %>
                      </p>
                      <span class="text-xs text-gray-500 dark:text-gray-400">
                        <%= time_ago_in_words_game_style(post.created_at) %>
                      </span>
                    </div>
                    <p class="text-sm text-gray-600 dark:text-gray-300 mt-1 line-clamp-2">
                      <%= post.body.presence || "#{post.weather_emoji} #{post.feeling_emoji}" %>
                    </p>
                    <div class="flex items-center mt-2 text-xs text-gray-500 dark:text-gray-400">
                      <span class="material-symbols-outlined text-sm mr-1">favorite</span>
                      <%= post.reactions_count %> „É™„Ç¢„ÇØ„Ç∑„Éß„É≥
                    </div>
                  </div>
                </div>
              <% end %>
            </div>
          <% else %>
            <p class="text-center text-gray-500 dark:text-gray-400 py-8">ÊäïÁ®ø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>
          <% end %>
        </div>
      </div>
    </div>

    <!-- ÊúÄËøë„ÅÆÊäïÁ®ø -->
    <div class="bg-white dark:bg-slate-800 rounded-lg shadow">
      <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
        <h2 class="text-lg font-bold text-gray-900 dark:text-white flex items-center">
          <span class="material-symbols-outlined mr-2">schedule</span>
          ÊúÄËøë„ÅÆÊäïÁ®ø
        </h2>
      </div>
      <div class="p-6 relative">
        <% if current_user.guest? %>
          <div class="absolute inset-0 z-10 flex items-center justify-center bg-white/10 dark:bg-slate-900/10 rounded-b-lg">
            <div class="px-4 py-2 bg-slate-800/90 text-white text-sm font-bold rounded-lg shadow-lg flex items-center space-x-2 backdrop-blur-md">
              <span class="material-symbols-outlined text-base">lock</span>
              <span>„Ç≤„Çπ„ÉàÈñ≤Ë¶ß„É¢„Éº„ÉâÔºà‰øùË≠∑‰∏≠Ôºâ</span>
            </div>
          </div>
        <% end %>

        <div class="<%= 'blur-[3px] pointer-events-none select-none opacity-80' if current_user.guest? %>">
          <% if @recent_posts.any? %>
            <div class="space-y-4">
              <% @recent_posts.each do |post| %>
                <div class="flex items-start space-x-3 p-3 bg-gray-50 dark:bg-slate-700 rounded-lg">
                  <%= user_avatar(post.user, classes: "h-10 w-10 rounded-full flex-shrink-0") %>
                  <div class="flex-1 min-w-0">
                    <div class="flex items-center justify-between">
                      <p class="text-sm font-medium text-gray-900 dark:text-white truncate">
                        <%= post.user.name %>
                      </p>
                      <span class="text-xs text-gray-500 dark:text-gray-400">
                        <%= time_ago_in_words_game_style(post.created_at) %>
                      </span>
                    </div>
                    <p class="text-sm text-gray-600 dark:text-gray-300 mt-1 line-clamp-2">
                      <%= post.body.presence || "#{post.weather_emoji} #{post.feeling_emoji}" %>
                    </p>
                  </div>
                </div>
              <% end %>
            </div>
          <% else %>
            <p class="text-center text-gray-500 dark:text-gray-400 py-8">ÊäïÁ®ø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <!-- ÊúÄËøë„ÅÆÁôªÈå≤„É¶„Éº„Ç∂„Éº -->
  <div class="bg-white dark:bg-slate-800 rounded-lg shadow">
    <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
      <h2 class="text-lg font-bold text-gray-900 dark:text-white flex items-center">
        <span class="material-symbols-outlined mr-2">person_add</span>
        ÊúÄËøë„ÅÆÁôªÈå≤„É¶„Éº„Ç∂„Éº
      </h2>
    </div>
    <div class="p-6 relative">
      <% if current_user.guest? %>
        <div class="absolute inset-0 z-10 flex items-center justify-center bg-white/10 dark:bg-slate-900/10 rounded-b-lg">
          <div class="px-4 py-2 bg-slate-800/90 text-white text-sm font-bold rounded-lg shadow-lg flex items-center space-x-2 backdrop-blur-md">
            <span class="material-symbols-outlined text-base">lock</span>
            <span>„Ç≤„Çπ„ÉàÈñ≤Ë¶ß„É¢„Éº„ÉâÔºà‰øùË≠∑‰∏≠Ôºâ</span>
          </div>
        </div>
      <% end %>

      <div class="<%= 'blur-[3px] pointer-events-none select-none opacity-80' if current_user.guest? %>">
        <% if @recent_users.any? %>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
            <% @recent_users.each do |user| %>
              <div class="flex flex-col items-center p-4 bg-gray-50 dark:bg-slate-700 rounded-lg">
                <%= user_avatar(user, classes: "h-16 w-16 rounded-full mb-2") %>
                <p class="text-sm font-medium text-gray-900 dark:text-white text-center truncate w-full">
                  <%= user.name %>
                </p>
                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                  <%= time_ago_in_words_game_style(user.created_at) %>
                </p>
              </div>
            <% end %>
          </div>
        <% else %>
          <p class="text-center text-gray-500 dark:text-gray-400 py-8">„É¶„Éº„Ç∂„Éº„Åå„ÅÑ„Åæ„Åõ„Çì</p>
        <% end %>
      </div>
    </div>
  </div>
</div>
