<% content_for :title, "てくメモ - ログインスタンプ" %>

<div class="flex-1 p-4 pb-24 w-full max-w-2xl mx-auto space-y-6">
  <!-- ページヘッダー -->
  <div class="flex items-center justify-between">
    <div>
      <h1 class="text-2xl font-bold text-gray-900 dark:text-white flex items-center space-x-2">
        <span class="material-symbols-outlined text-3xl text-transparent bg-clip-text bg-gradient-to-r from-blue-500 to-cyan-500 dark:text-cyan-400 drop-shadow-sm dark:drop-shadow-[0_0_5px_rgba(34,211,238,0.8)]">calendar_month</span>
        <span class="text-transparent bg-clip-text bg-gradient-to-r from-gray-800 to-gray-600 dark:from-cyan-300 dark:to-purple-400 drop-shadow-sm">てくてくスタンプ</span>
      </h1>
      <p class="text-sm text-gray-500 dark:text-slate-400 mt-1 ml-1">日々の積み重ねを可視化しましょう</p>
    </div>
  </div>

  <!-- 統計情報 -->
  <div class="grid grid-cols-2 gap-3 sm:gap-4">
    <!-- 今月の散歩日数 -->
    <div class="bg-gradient-to-br from-cyan-400 to-blue-500 dark:from-slate-900/90 dark:to-cyan-950/90 backdrop-blur-xl p-3 sm:p-5 rounded-2xl shadow-lg dark:shadow-[0_0_15px_rgba(6,182,212,0.2)] text-white relative overflow-hidden group hover:scale-[1.02] transition-transform duration-300 border border-transparent dark:border-cyan-500/30 flex flex-col justify-between h-full">
      <div class="absolute top-0 right-0 -mr-4 -mt-4 w-20 h-20 bg-white/20 dark:bg-cyan-500/10 rounded-full blur-xl pointer-events-none"></div>
      <div class="flex items-center space-x-1 sm:space-x-2 mb-1 sm:mb-2 relative z-10">
        <span class="material-symbols-outlined text-white dark:text-cyan-400 drop-shadow-md text-xl sm:text-2xl">event_available</span>
        <h3 class="font-bold text-shadow dark:text-cyan-100 text-xs sm:text-base whitespace-nowrap">てくてく日数</h3>
      </div>
      <p class="text-2xl sm:text-3xl font-bold text-shadow dark:text-cyan-300 dark:drop-shadow-[0_0_5px_rgba(34,211,238,0.5)] relative z-10"><%= @monthly_walk_count %><span class="text-xs sm:text-base ml-1 font-normal dark:text-cyan-400">日</span></p>
    </div>

    <!-- 連続日数 -->
    <div class="bg-gradient-to-br from-orange-400 to-pink-500 dark:from-slate-900/90 dark:to-fuchsia-950/90 backdrop-blur-xl p-3 sm:p-5 rounded-2xl shadow-lg dark:shadow-[0_0_15px_rgba(192,38,211,0.2)] text-white relative overflow-hidden group hover:scale-[1.02] transition-transform duration-300 border border-transparent dark:border-fuchsia-500/30 flex flex-col justify-between h-full">
      <div class="absolute top-0 right-0 -mr-4 -mt-4 w-20 h-20 bg-white/20 dark:bg-fuchsia-500/10 rounded-full blur-xl pointer-events-none"></div>
      <div class="flex items-center space-x-1 sm:space-x-2 mb-1 sm:mb-2 relative z-10">
        <span class="material-symbols-outlined text-white dark:text-fuchsia-400 drop-shadow-md text-xl sm:text-2xl">local_fire_department</span>
        <h3 class="font-bold text-shadow dark:text-fuchsia-100 text-xs sm:text-base whitespace-nowrap">連続</h3>
      </div>
      <p class="text-2xl sm:text-3xl font-bold text-shadow dark:text-fuchsia-300 dark:drop-shadow-[0_0_5px_rgba(232,121,249,0.5)] relative z-10"><%= @consecutive_days %><span class="text-xs sm:text-base ml-1 font-normal dark:text-fuchsia-400">日</span></p>
    </div>
  </div>

  <!-- カレンダー -->
  <div class="bg-white/80 dark:bg-slate-950/80 backdrop-blur-xl rounded-3xl shadow-xl dark:shadow-[0_0_20px_rgba(6,182,212,0.15)] p-6 transition-colors relative overflow-hidden border border-white/20 dark:border-cyan-500/20">
    <!-- 装飾用背景 -->
    <div class="absolute top-0 left-0 w-full h-1.5 bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 dark:from-cyan-500 dark:via-blue-500 dark:to-purple-500 dark:shadow-[0_0_10px_rgba(34,211,238,0.5)]"></div>

    <!-- 月ナビゲーション -->
    <div class="flex justify-center items-center space-x-6 mb-6 mt-2">
      <!-- 前月ボタン -->
      <%= link_to login_stamps_path(start_date: @start_date - 1.month),
          class: "flex items-center justify-center w-10 h-10 rounded-full bg-gray-50 dark:bg-slate-800/50 hover:bg-blue-50 dark:hover:bg-cyan-900/30 text-gray-600 dark:text-cyan-400 hover:text-blue-600 dark:hover:text-cyan-300 transition-all duration-200 shadow-sm hover:shadow border border-gray-200 dark:border-cyan-500/20" do %>
        <span class="material-symbols-outlined">chevron_left</span>
      <% end %>

      <!-- 現在の月を表示 -->
      <h2 class="text-xl sm:text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600 dark:from-cyan-300 dark:to-purple-400 tracking-tight dark:drop-shadow-[0_0_5px_rgba(34,211,238,0.3)] whitespace-nowrap">
        <%= @start_date.strftime("%Y年%m月") %>
      </h2>

      <!-- 次月ボタン -->
      <%= link_to login_stamps_path(start_date: @start_date + 1.month),
          class: "flex items-center justify-center w-10 h-10 rounded-full bg-gray-50 dark:bg-slate-800/50 hover:bg-blue-50 dark:hover:bg-cyan-900/30 text-gray-600 dark:text-cyan-400 hover:text-blue-600 dark:hover:text-cyan-300 transition-all duration-200 shadow-sm hover:shadow border border-gray-200 dark:border-cyan-500/20 flex-shrink-0" do %>
        <span class="material-symbols-outlined">chevron_right</span>
      <% end %>
    </div>

    <!-- カレンダー本体 -->
    <div class="calendar-container">
      <%= month_calendar(attribute: :walked_on, start_date: @start_date, events: @walks, week_start: :sunday) do |date, walks| %>
        <%
          has_stamp = @walks_by_date[date].present?
          is_today = date == Date.today
          is_other_month = date.month != @start_date.month

          classes = ["calendar-day"]
          classes << "has-stamp" if has_stamp
          classes << "today" if is_today
          classes << "other-month" if is_other_month
        %>
        <div class="<%= classes.join(' ') %> group relative">
          <!-- 日付（左上に配置） -->
          <div class="date-number absolute top-1 left-1 z-20">
            <%= date.day %>
          </div>

          <!-- スタンプアイコン（スタンプがある場合のみ、中央に大きく） -->
          <% if has_stamp %>
            <div class="stamp-icon absolute inset-0 flex items-center justify-center z-10 pointer-events-none">
              <span class="material-symbols-outlined text-4xl sm:text-5xl transform rotate-12 select-none transition-all duration-300 animate-pulse">pets</span>
            </div>
          <% elsif is_today %>
            <!-- 今日でスタンプがない場合、「今日」と表示 -->
            <div class="absolute inset-0 flex items-center justify-center z-10 pointer-events-none">
              <span class="text-sm sm:text-xl font-bold text-blue-500/30 dark:text-cyan-400/60 select-none tracking-wider">今日</span>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- カレンダーの見方 -->
  <div class="bg-gray-50/80 dark:bg-slate-900/50 border border-gray-200 dark:border-cyan-500/20 rounded-2xl p-4 transition-colors backdrop-blur-sm">
    <div class="flex items-start space-x-3">
      <div class="bg-blue-100 dark:bg-cyan-900/30 p-2 rounded-full flex-shrink-0">
        <span class="material-symbols-outlined text-blue-500 dark:text-cyan-400 text-xl">info</span>
      </div>
      <div class="flex-1 pt-1 overflow-hidden">
        <h3 class="font-bold text-gray-900 dark:text-cyan-100 mb-3 text-sm whitespace-nowrap">カレンダーの見方</h3>
        <div class="grid grid-cols-2 gap-2 sm:gap-3">
          <div class="flex items-center space-x-1 sm:space-x-2">
            <div class="w-6 h-6 rounded-lg bg-gradient-to-br from-orange-400 to-pink-500 dark:text-fuchsia-400 shadow-sm flex items-center justify-center flex-shrink-0">
              <span class="material-symbols-outlined text-white text-xs">pets</span>
            </div>
            <span class="text-[10px] sm:text-xs text-gray-600 dark:text-slate-400 whitespace-nowrap">散歩記録あり</span>
          </div>
          <div class="flex items-center space-x-1 sm:space-x-2">
            <div class="w-6 h-6 rounded-lg border-2 border-blue-400 dark:border-cyan-400 flex items-center justify-center flex-shrink-0">
              <span class="text-[10px] font-bold text-blue-500 dark:text-cyan-400">今日</span>
            </div>
            <span class="text-[10px] sm:text-xs text-gray-600 dark:text-slate-400 whitespace-nowrap">今日の日付</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- カレンダー用のスタイル -->
<style>
  /* カレンダー全体のコンテナ */
  .calendar-container {
    overflow-x: hidden; /* 横スクロール防止 */
    padding-bottom: 4px;
  }

  /* simple_calendarのデフォルトヘッダーを非表示 */
  .simple-calendar .calendar-heading {
    display: none;
  }

  /* simple_calendarのテーブルスタイル */
  .simple-calendar {
    width: 100%;
  }

  .simple-calendar table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 4px;
    table-layout: fixed;
  }

  /* テーブルヘッダー（曜日） */
  .simple-calendar thead th {
    padding: 0.75rem 0.25rem;
    text-align: center;
    font-weight: 700;
    font-size: 0.8rem;
    color: #6B7280;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .dark .simple-calendar thead th {
    color: #94a3b8;
  }

  /* 日曜・土曜の色 */
  .simple-calendar thead th:first-child { color: #EF4444; }
  .dark .simple-calendar thead th:first-child { color: #F87171; }
  .simple-calendar thead th:last-child { color: #3B82F6; }
  .dark .simple-calendar thead th:last-child { color: #60A5FA; }

  /* カレンダーのセル（td） */
  .simple-calendar td {
    padding: 0;
    border: none;
    height: 80px;
    vertical-align: top;
    background-color: transparent;
  }

  /* カレンダーの日付セルの中身（.calendar-day） */
  .calendar-day {
    width: 100%;
    height: 100%;
    display: block; /* flexからblockに変更（絶対配置を使うため） */
    border-radius: 1rem;
    background-color: #F9FAFB;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    border: 1px solid transparent;
  }

  .dark .calendar-day {
    background-color: rgba(15, 23, 42, 0.6);
    border-color: rgba(34, 211, 238, 0.1);
  }

  /* ホバーエフェクト */
  .calendar-day:not(.other-month):hover {
    background-color: #F3F4F6;
    transform: translateY(-2px);
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    border-color: #E5E7EB;
  }

  .dark .calendar-day:not(.other-month):hover {
    background-color: rgba(8, 145, 178, 0.2);
    border-color: rgba(34, 211, 238, 0.4);
    box-shadow: 0 0 10px rgba(34, 211, 238, 0.2);
  }

  /* スタンプがある日（背景は控えめに、スタンプを目立たせる） */
  .calendar-day.has-stamp {
    background-color: #FFF7ED; /* Orange-50 */
    border: 1px solid #FFEDD5; /* Orange-100 */
  }

  .dark .calendar-day.has-stamp {
    background-color: rgba(112, 26, 117, 0.2); /* Fuchsia-900/20 */
    border: 1px solid rgba(232, 121, 249, 0.3); /* Fuchsia-400/30 */
    box-shadow: 0 0 15px rgba(232, 121, 249, 0.15);
  }

  /* スタンプアイコンのスタイル */
  .stamp-icon .material-symbols-outlined {
    /* ライトモード: オレンジ〜ピンクのグラデーションテキスト */
    background: linear-gradient(135deg, #FB923C, #EC4899); /* Orange-400 to Pink-500 */
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    filter: drop-shadow(0 2px 4px rgba(236, 72, 153, 0.3));
    opacity: 0.9;
  }

  .dark .stamp-icon .material-symbols-outlined {
    /* ダークモード: ネオン発光 */
    background: none;
    -webkit-background-clip: border-box;
    -webkit-text-fill-color: #e879f9; /* Fuchsia-400 */
    color: #e879f9;
    filter: drop-shadow(0 0 8px rgba(232, 121, 249, 0.8)) drop-shadow(0 0 15px rgba(192, 38, 211, 0.6));
    opacity: 1;
  }

  /* 今日の日付（枠線で強調） */
  .calendar-day.today {
    background-color: #EFF6FF;
    border: 2px solid #60A5FA;
  }

  .dark .calendar-day.today {
    background-color: rgba(15, 23, 42, 0.8);
    border-color: #22d3ee;
    box-shadow: 0 0 10px rgba(34, 211, 238, 0.2);
  }

  /* 他の月の日付 */
  .calendar-day.other-month {
    background-color: transparent;
    opacity: 0.4;
  }

  /* 日付の数字 */
  .date-number {
    font-size: 0.75rem;
    font-weight: 700;
    color: #9CA3AF; /* Gray-400 */
    width: 1.5rem;
    height: 1.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 9999px;
    background-color: rgba(255, 255, 255, 0.8); /* 数字の背景を少し白くして視認性確保 */
    backdrop-filter: blur(2px);
  }

  .dark .date-number {
    color: #94a3b8; /* Slate-400 */
    background-color: rgba(15, 23, 42, 0.6);
  }

  /* 今日の日付数字 */
  .calendar-day.today .date-number {
    color: #2563EB;
    background-color: #DBEAFE;
  }

  .dark .calendar-day.today .date-number {
    color: #22d3ee;
    background-color: rgba(6, 182, 212, 0.2);
  }

  /* スタンプがある日の日付数字（少し色をつける） */
  .calendar-day.has-stamp .date-number {
    color: #EA580C; /* Orange-600 */
  }

  .dark .calendar-day.has-stamp .date-number {
    color: #f0abfc; /* Fuchsia-300 */
  }

  /* モバイル対応 */
  @media (max-width: 640px) {
    .simple-calendar table {
      border-spacing: 2px; /* 間隔を狭める */
    }
    .simple-calendar td {
      height: 56px; /* 高さを小さく */
    }
    .calendar-day {
      border-radius: 0.5rem; /* 角丸を少し小さく */
    }
    .date-number {
      font-size: 0.65rem;
      width: 1.1rem;
      height: 1.1rem;
      top: 2px;
      left: 2px;
    }
    .stamp-icon .material-symbols-outlined {
      font-size: 2rem; /* アイコンサイズ調整 */
    }
    /* 今日の文字サイズ調整はHTML側のクラスで行う */
  }
</style>
