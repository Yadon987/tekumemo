<!-- app/views/rankings/index.html.erb -->
<%# ãƒ©ãƒ³ã‚­ãƒ³ã‚°ç”»é¢ã®ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã§ã¯ã€å…±é€šã®èƒŒæ™¯ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆãƒ‘ãƒ«ã‚¹ï¼‰ãŒç‹¬è‡ªèƒŒæ™¯ã¨å¹²æ¸‰ã™ã‚‹ãŸã‚éè¡¨ç¤ºã«ã™ã‚‹ %>
<style>
  html.dark body > .fixed.-z-10 {
    display: none !important;
  }
  /* ãƒ˜ãƒƒãƒ€ãƒ¼ã®å¢ƒç•Œç·šã‚’æ¶ˆã™ */
  html.dark header {
    border-bottom-color: transparent !important;
  }
</style>
<div class="min-h-screen dark:bg-gradient-to-br dark:from-slate-900 dark:via-purple-800 dark:to-purple-900 pb-20 relative overflow-hidden">

  <!-- èƒŒæ™¯ã®è£…é£¾ -->
  <!-- ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ç”¨ï¼ˆå°‚ç”¨ãƒã‚ªãƒ³èƒŒæ™¯ï¼‰ -->
  <div class="hidden dark:block absolute inset-0 overflow-hidden pointer-events-none -z-10">
    <div class="absolute top-20 left-10 w-72 h-72 bg-purple-500/30 rounded-full mix-blend-multiply filter blur-3xl opacity-70"></div>
    <div class="absolute top-20 right-10 w-72 h-72 bg-pink-500/30 rounded-full mix-blend-multiply filter blur-3xl opacity-70"></div>
    <div class="absolute -bottom-8 left-20 w-72 h-72 bg-blue-500/30 rounded-full mix-blend-multiply filter blur-3xl opacity-70"></div>
  </div>

  <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¨ãƒªã‚¢ -->
  <div class="relative z-10 pt-8 pb-6 px-4 text-center">
    <div class="inline-block relative">
      <h1 class="text-4xl md:text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-600 via-pink-500 to-orange-500 dark:from-yellow-300 dark:via-pink-300 dark:to-purple-300 tracking-tight drop-shadow-sm dark:drop-shadow-2xl">
        <%= t('rankings.index.title') %>
      </h1>
      <div class="absolute -top-6 -right-8 text-4xl animate-bounce">ğŸ†</div>
      <div class="absolute -bottom-2 -left-6 text-3xl animate-spin-slow">âœ¨</div>
    </div>
    <p class="text-slate-600 dark:text-purple-200 text-sm mt-3 font-bold tracking-wide"><%= t('rankings.index.subtitle') %></p>

    <!-- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ -->
    <div class="mt-4 flex items-center justify-center gap-2 text-xs text-slate-500 dark:text-purple-300">
      <span class="relative flex h-2 w-2">
        <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
        <span class="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span>
      </span>
      <span><%= period_label_ja(@period) %><%= t('rankings.index.list_title') %></span>
      <span class="text-slate-400 dark:text-purple-400"><%= t('rankings.index.update_frequency') %></span>
    </div>
  </div>

  <!-- æœŸé–“åˆ‡ã‚Šæ›¿ãˆã‚¿ãƒ– -->
  <div class="px-6 mb-8 relative z-10">
    <div class="bg-[#fdfbf7] dark:bg-slate-800/50 dark:backdrop-blur-xl p-1.5 rounded-full shadow-[inset_6px_6px_12px_rgba(166,175,195,0.2),inset_-6px_-6px_12px_rgba(255,255,255,0.8)] dark:shadow-[0_0_30px_rgba(168,85,247,0.3)] border border-white/50 dark:border-purple-500/30 flex justify-between items-center max-w-md mx-auto">
      <% [
        { id: 'daily', label: t('rankings.index.tabs.daily'), icon: 'ğŸ“…' },
        { id: 'monthly', label: t('rankings.index.tabs.monthly'), icon: 'ğŸ“Š' },
        { id: 'yearly', label: t('rankings.index.tabs.yearly'), icon: 'ğŸŒŸ' }
      ].each do |tab| %>
        <%= link_to rankings_path(period: tab[:id]),
            data: { turbo_frame: "_top" },
            class: "flex-1 text-center py-3 px-4 rounded-full text-sm font-bold transition-all duration-300 relative overflow-hidden group #{
              @period == tab[:id] ?
              'text-purple-700 dark:text-white bg-white dark:bg-gradient-to-r dark:from-purple-600 dark:to-pink-600 shadow-[4px_4px_8px_rgba(166,175,195,0.2),-4px_-4px_8px_rgba(255,255,255,0.9)] dark:shadow-[0_0_20px_rgba(168,85,247,0.5)]' :
              'text-slate-400 dark:text-purple-300 hover:text-slate-600 dark:hover:text-white hover:-translate-y-0.5 dark:hover:bg-slate-700/50'
            }" do %>
          <span class="relative z-10 flex items-center justify-center gap-1">
            <span class="text-base"><%= tab[:icon] %></span>
            <%= tab[:label] %>
          </span>
        <% end %>
      <% end %>
    </div>
  </div>

  <!-- è‡ªåˆ†ã®ã‚¹ã‚³ã‚¢ã‚«ãƒ¼ãƒ‰ -->
  <div class="px-4 mb-8 sticky top-4 z-20 max-w-2xl mx-auto w-full">
    <% if @my_rank %>
      <div class="relative group">
        <!-- ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ç”¨ã‚°ãƒ­ãƒ¼ -->
        <div class="hidden dark:block absolute -inset-1 bg-gradient-to-r from-purple-600 via-pink-600 to-purple-600 rounded-[2rem] blur-lg opacity-75 group-hover:opacity-100 transition animate-pulse"></div>

        <div class="relative bg-white dark:bg-gradient-to-br dark:from-slate-800 dark:to-slate-900 rounded-[2rem] p-6 border-2 border-white dark:border-purple-500/50 shadow-[14px_14px_28px_rgba(166,175,195,0.25),-14px_-14px_28px_rgba(255,255,255,0.9)] dark:shadow-2xl backdrop-blur-xl">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-4">
              <div class="relative">
                <div class="w-16 h-16 rounded-2xl bg-gradient-to-br <%= @my_rank <= 3 ? 'from-yellow-300 to-orange-400 dark:from-yellow-400 dark:to-orange-500' : 'from-purple-400 to-pink-400 dark:from-purple-500 dark:to-pink-500' %> flex flex-col items-center justify-center shadow-[inset_-2px_-2px_5px_rgba(255,255,255,0.7),inset_2px_2px_5px_rgba(0,0,0,0.1)] dark:shadow-lg transform group-hover:scale-110 transition-transform leading-none">
                  <span class="text-3xl font-black text-white drop-shadow-md"><%= @my_rank %></span>
                  <span class="text-[10px] font-bold text-white/90 uppercase"><%= ordinal_suffix(@my_rank) %></span>
                </div>
                <% if @my_rank <= 3 %>
                  <div class="absolute -top-2 -right-2 text-2xl animate-bounce">ğŸ‘‘</div>
                <% end %>
              </div>

              <div>
                <p class="text-xs text-purple-400 dark:text-purple-300 font-bold uppercase tracking-wider mb-1"><%= t('rankings.index.your_rank.title') %></p>
                <p class="text-2xl font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-pink-600 dark:from-yellow-300 dark:to-pink-300">
                  <%= @my_rank %> <span class="text-sm"><%= t('rankings.index.your_rank.rank_suffix') %></span>
                </p>
                <% if @my_rank <= 10 %>
                  <p class="text-[10px] text-green-600 dark:text-green-400 font-bold mt-1">ğŸ”¥ <%= t('rankings.index.your_rank.top_10') %></p>
                <% end %>
              </div>
            </div>

            <div class="text-right">
              <p class="text-xs text-purple-400 dark:text-purple-300 font-bold uppercase tracking-wider mb-1"><%= t('rankings.index.your_rank.distance') %></p>
              <p class="text-3xl font-black text-slate-700 dark:text-white">
                <%= number_with_precision(@my_distance, precision: 1) %>
              </p>
              <p class="text-xs text-slate-500 dark:text-purple-400"><%= t('rankings.index.your_rank.unit') %></p>

              <% if @distance_to_top > 0 %>
                <p class="text-[10px] text-orange-500 dark:text-yellow-400 mt-2 font-bold">
                  ğŸ¯ <%= t('rankings.index.your_rank.distance_to_top') %>: <%= number_with_precision(@distance_to_top, precision: 1) %>km
                </p>
              <% end %>
            </div>
          </div>

          <!-- ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ -->
          <% if @my_rank && @my_rank > 1 %>
            <% next_rank_distance = @rankings[@my_rank - 2]&.total_distance.to_f %>
            <% distance_needed = next_rank_distance - @my_distance %>
            <% if distance_needed > 0 %>
              <div class="mt-4 pt-4 border-t border-purple-100 dark:border-purple-500/30">
                <div class="flex justify-between text-xs text-slate-500 dark:text-purple-300 mb-2">
                  <span><%= t('rankings.index.your_rank.distance_to_next') %></span>
                  <span class="font-bold text-orange-600 dark:text-yellow-400"><%= number_with_precision(distance_needed, precision: 1) %>km</span>
                </div>
                <div class="h-3 bg-slate-100 dark:bg-slate-700 rounded-full overflow-hidden shadow-inner">
                  <div class="h-full bg-gradient-to-r from-purple-400 to-pink-400 dark:from-purple-500 dark:to-pink-500 rounded-full transition-all duration-500 dark:shadow-lg dark:shadow-purple-500/50"
                       style="width: <%= [(@my_distance / next_rank_distance * 100), 100].min %>%"></div>
                </div>
              </div>
            <% end %>
          <% end %>
        </div>
      </div>
    <% else %>
      <!-- ãƒ©ãƒ³ã‚­ãƒ³ã‚°å¤– -->
      <div class="relative group">
        <div class="hidden dark:block absolute -inset-1 bg-gradient-to-r from-orange-600 to-red-600 rounded-[2rem] blur-lg opacity-50 group-hover:opacity-75 transition"></div>

        <div class="relative bg-orange-50 dark:bg-gradient-to-br dark:from-slate-800 dark:to-slate-900 rounded-[2rem] p-6 border-2 border-white dark:border-orange-500/50 shadow-[14px_14px_28px_rgba(166,175,195,0.25),-14px_-14px_28px_rgba(255,255,255,0.9)] dark:shadow-2xl">
          <div class="flex items-center gap-4">
            <div class="text-5xl animate-bounce">ğŸ”¥</div>
            <div class="flex-1">
              <p class="text-lg font-black text-transparent bg-clip-text bg-gradient-to-r from-orange-500 to-red-500 dark:from-orange-300 dark:to-red-300 mb-1">
                <%= t('rankings.index.empty.challenge') %>
              </p>
              <p class="text-sm text-slate-600 dark:text-purple-200">
                <%= period_label_ja(@period) %>: <span class="font-bold text-slate-800 dark:text-white"><%= number_with_precision(@my_distance, precision: 1) %>km</span>
              </p>
              <p class="text-xs text-orange-500 dark:text-orange-400 mt-2">ğŸ’ª <%= t('rankings.index.empty.cheer') %></p>
            </div>
            <div class="text-4xl">âš¡</div>
          </div>
        </div>
      </div>
    <% end %>
  </div>

  <!-- è¡¨å½°å°ï¼ˆãƒˆãƒƒãƒ—3å°‚ç”¨ã‚¨ãƒªã‚¢ï¼‰ -->
  <% if @rankings.size >= 3 %>
    <div class="px-4 mb-8 max-w-2xl mx-auto">
      <h2 class="text-center text-xl font-black text-slate-700 dark:text-purple-200 mb-6 flex items-center justify-center gap-2">
        <span>ğŸ†</span> <%= t('rankings.index.podium') %> <span>ğŸ†</span>
      </h2>

      <div class="flex items-end justify-center gap-4 mb-8">
        <!-- 2ä½ -->
        <div class="flex-1 text-center transform hover:scale-105 transition-transform">
          <div class="relative inline-block mb-2">
            <% second = @rankings[1] %>
            <% if second.avatar_url.present? && second.use_google_avatar %>
              <%= image_tag second.avatar_url, class: "relative w-16 h-16 rounded-full border-4 border-slate-300 dark:border-slate-400 shadow-[8px_8px_16px_rgba(166,175,195,0.4),-8px_-8px_16px_rgba(255,255,255,0.8)] dark:shadow-xl" %>
            <% else %>
              <div class="relative w-16 h-16 rounded-full border-4 border-slate-300 dark:border-slate-400 bg-slate-100 dark:bg-slate-600 flex items-center justify-center text-2xl shadow-[8px_8px_16px_rgba(166,175,195,0.4),-8px_-8px_16px_rgba(255,255,255,0.8)] dark:shadow-xl">ğŸ‘¤</div>
            <% end %>
            <div class="absolute -bottom-2 -right-2 text-3xl">ğŸ¥ˆ</div>
          </div>
          <p class="text-slate-700 dark:text-white font-bold text-sm truncate"><%= second.name.presence || "No Name" %></p>
          <p class="text-slate-500 dark:text-slate-300 text-xs"><%= number_with_precision(second.total_distance, precision: 1) %>km</p>
          <div class="mt-2 h-24 bg-gradient-to-t from-slate-300 to-slate-200 dark:from-slate-400 dark:to-slate-500 rounded-t-2xl border-4 border-white dark:border-slate-300 shadow-[8px_8px_16px_rgba(166,175,195,0.3)] dark:shadow-lg flex items-center justify-center">
            <span class="text-3xl font-black text-slate-600 dark:text-white drop-shadow-sm">2</span>
          </div>
        </div>

        <!-- 1ä½ -->
        <div class="flex-1 text-center transform hover:scale-110 transition-transform">
          <div class="relative inline-block mb-2">
            <% first = @rankings[0] %>
            <% if first.avatar_url.present? && first.use_google_avatar %>
              <%= image_tag first.avatar_url, class: "relative w-20 h-20 rounded-full border-4 border-yellow-400 shadow-[10px_10px_20px_rgba(250,204,21,0.4),-10px_-10px_20px_rgba(255,255,255,0.9)] dark:shadow-2xl" %>
            <% else %>
              <div class="relative w-20 h-20 rounded-full border-4 border-yellow-400 bg-yellow-100 dark:bg-yellow-600 flex items-center justify-center text-3xl shadow-[10px_10px_20px_rgba(250,204,21,0.4),-10px_-10px_20px_rgba(255,255,255,0.9)] dark:shadow-2xl">ğŸ‘¤</div>
            <% end %>
            <div class="absolute -top-3 left-1/2 -translate-x-1/2 text-4xl animate-bounce">ğŸ‘‘</div>
            <div class="absolute -bottom-2 -right-2 text-4xl drop-shadow-lg">ğŸ¥‡</div>
          </div>
          <p class="text-yellow-700 dark:text-yellow-300 font-black text-base truncate">ğŸŒŸ <%= first.name.presence || "No Name" %></p>
          <p class="text-yellow-600 dark:text-yellow-200 text-sm font-bold"><%= number_with_precision(first.total_distance, precision: 1) %>km</p>
          <div class="mt-2 h-32 bg-gradient-to-t from-yellow-400 via-yellow-300 to-yellow-200 dark:from-yellow-400 dark:via-yellow-500 dark:to-yellow-600 rounded-t-2xl border-4 border-white dark:border-yellow-300 shadow-[10px_10px_20px_rgba(250,204,21,0.4),-10px_-10px_20px_rgba(255,255,255,0.9)] dark:shadow-[0_0_30px_rgba(250,204,21,0.5)] flex items-center justify-center">
            <span class="text-4xl font-black text-yellow-800 dark:text-white drop-shadow-sm">1</span>
          </div>
        </div>

        <!-- 3ä½ -->
        <div class="flex-1 text-center transform hover:scale-105 transition-transform">
          <div class="relative inline-block mb-2">
            <% third = @rankings[2] %>
            <% if third.avatar_url.present? && third.use_google_avatar %>
              <%= image_tag third.avatar_url, class: "relative w-16 h-16 rounded-full border-4 border-orange-300 dark:border-orange-400 shadow-[8px_8px_16px_rgba(251,146,60,0.4),-8px_-8px_16px_rgba(255,255,255,0.8)] dark:shadow-xl" %>
            <% else %>
              <div class="relative w-16 h-16 rounded-full border-4 border-orange-300 dark:border-orange-400 bg-orange-100 dark:bg-orange-600 flex items-center justify-center text-2xl shadow-[8px_8px_16px_rgba(251,146,60,0.4),-8px_-8px_16px_rgba(255,255,255,0.8)] dark:shadow-xl">ğŸ‘¤</div>
            <% end %>
            <div class="absolute -bottom-2 -right-2 text-3xl">ğŸ¥‰</div>
          </div>
          <p class="text-slate-700 dark:text-white font-bold text-sm truncate"><%= third.name.presence || "No Name" %></p>
          <p class="text-orange-600 dark:text-orange-300 text-xs"><%= number_with_precision(third.total_distance, precision: 1) %>km</p>
          <div class="mt-2 h-20 bg-gradient-to-t from-orange-300 to-orange-200 dark:from-orange-400 dark:to-orange-500 rounded-t-2xl border-4 border-white dark:border-orange-300 shadow-[8px_8px_16px_rgba(251,146,60,0.3)] dark:shadow-lg flex items-center justify-center">
            <span class="text-3xl font-black text-orange-700 dark:text-white drop-shadow-sm">3</span>
          </div>
        </div>
      </div>
    </div>
  <% end %>

  <!-- ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒªã‚¹ãƒˆï¼ˆ4ä½ä»¥é™ï¼‰ -->
  <div class="px-4 max-w-2xl mx-auto space-y-3">
    <% if @rankings.size > 3 %>
      <h3 class="text-lg font-bold text-slate-700 dark:text-purple-200 mb-4 flex items-center gap-2">
        <span class="text-2xl">ğŸ“Š</span> <%= t('rankings.index.list_title') %>
      </h3>
    <% end %>

    <% @rankings.each_with_index do |user, index| %>
      <% rank = index + 1 %>
      <% next if rank <= 3 %>
      <% is_current_user = user.id == current_user.id %>

      <div class="relative group transition-all duration-300 hover:-translate-y-1">
        <!-- ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ç”¨ã‚°ãƒ­ãƒ¼ï¼ˆè‡ªåˆ†ã®å ´åˆï¼‰ -->
        <% if is_current_user %>
          <div class="hidden dark:block absolute -inset-0.5 bg-gradient-to-r from-purple-600 to-pink-600 rounded-2xl blur opacity-75"></div>
        <% end %>

        <div class="relative bg-white dark:bg-slate-800/70 dark:backdrop-blur-sm rounded-2xl p-4 border-2 border-white dark:border-<%= is_current_user ? 'purple-500/70' : 'slate-700/50' %> shadow-[6px_6px_12px_rgba(166,175,195,0.15),-6px_-6px_12px_rgba(255,255,255,0.8)] hover:shadow-[10px_10px_20px_rgba(166,175,195,0.2),-10px_-10px_20px_rgba(255,255,255,1)] dark:shadow-lg dark:hover:shadow-xl transition-shadow flex items-center gap-4 <%= 'ring-2 ring-purple-300 ring-offset-2 ring-offset-[#fdfbf7] dark:ring-0' if is_current_user %>">

          <!-- é †ä½ãƒãƒƒã‚¸ -->
          <div class="w-12 h-12 flex-shrink-0 flex items-center justify-center rounded-xl shadow-[inset_-2px_-2px_5px_rgba(255,255,255,0.7),inset_2px_2px_5px_rgba(0,0,0,0.1)] dark:shadow-inner <%= rank <= 10 ? 'bg-gradient-to-br from-purple-300 to-pink-300 dark:from-purple-500 dark:to-pink-500' : 'bg-slate-100 dark:bg-slate-700' %>">
            <span class="text-xl font-black <%= rank <= 10 ? 'text-purple-700 dark:text-white' : 'text-slate-600 dark:text-slate-300' %>"><%= rank %></span>
          </div>

          <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ± -->
          <div class="flex-1 min-w-0 flex items-center gap-3">
            <% if user.avatar_url.present? && user.use_google_avatar %>
              <%= image_tag user.avatar_url, class: "w-10 h-10 rounded-full border-2 border-slate-200 dark:border-white/20 shadow-sm" %>
            <% else %>
              <div class="w-10 h-10 rounded-full bg-slate-100 dark:bg-slate-600 border-2 border-slate-200 dark:border-white/20 shadow-sm flex items-center justify-center text-sm">ğŸ‘¤</div>
            <% end %>

            <div class="flex-1 min-w-0">
              <p class="font-bold <%= is_current_user ? 'text-purple-700 dark:text-purple-300' : 'text-slate-700 dark:text-white' %> truncate flex items-center gap-2">
                <%= user.name.presence || "No Name" %>
                <% if is_current_user %>
                  <span class="text-xs bg-purple-500 text-white px-2 py-0.5 rounded-full shadow-sm"><%= t('rankings.index.you') %></span>
                <% end %>
              </p>
              <% if rank <= 10 %>
                <p class="text-[10px] text-purple-500 dark:text-purple-400 font-bold">TOP 10</p>
              <% end %>
            </div>
          </div>

          <!-- è·é›¢ -->
          <div class="text-right">
            <span class="block text-2xl font-black <%= is_current_user ? 'text-purple-600 dark:text-purple-300' : 'text-slate-700 dark:text-white' %> group-hover:text-purple-600 dark:group-hover:text-purple-400 transition-colors">
              <%= number_with_precision(user.total_distance, precision: 1) %>
            </span>
            <span class="text-[10px] text-slate-400 dark:text-slate-500 font-bold uppercase tracking-wider">km</span>
          </div>
        </div>
      </div>
    <% end %>

    <!-- ç©ºçŠ¶æ…‹ -->
    <% if @rankings.empty? %>
      <div class="relative group">
        <div class="hidden dark:block absolute -inset-1 bg-gradient-to-r from-purple-600 to-pink-600 rounded-[2.5rem] blur-xl opacity-30"></div>

        <div class="relative bg-white dark:bg-slate-800/70 dark:backdrop-blur-sm rounded-[2.5rem] p-12 border-2 border-white dark:border-slate-700/50 shadow-[14px_14px_28px_rgba(166,175,195,0.25),-14px_-14px_28px_rgba(255,255,255,0.9)] dark:shadow-lg text-center">
          <div class="text-7xl mb-6 animate-bounce">ğŸƒ</div>
          <p class="text-slate-700 dark:text-white font-black text-2xl mb-3"><%= t('rankings.index.empty.title') %></p>
          <p class="text-slate-500 dark:text-purple-300 text-sm mb-8"><%= t('rankings.index.empty.subtitle') %></p>
          <%= link_to t('rankings.index.empty.action'), new_walk_path,
              class: "inline-block px-8 py-4 bg-gradient-to-r from-purple-500 to-pink-500 dark:from-purple-600 dark:to-pink-600 text-white font-bold rounded-full shadow-lg hover:scale-110 hover:shadow-xl dark:hover:shadow-2xl dark:hover:shadow-purple-500/50 transition-all" %>
        </div>
      </div>
    <% end %>
  </div>

  <div class="h-20"></div>
</div>


